<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Vitalis AI</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #080c10;
  --bg2: #0d1117;
  --bg3: #141920;
  --card: #111820;
  --card2: #161f28;
  --border: rgba(255,255,255,0.07);
  --accent: #00e5ff;
  --accent2: #7c3aed;
  --accent3: #10b981;
  --accent4: #f59e0b;
  --accent5: #ef4444;
  --text: #f0f6ff;
  --text2: #8a9ab5;
  --text3: #4a5568;
  --glow: 0 0 30px rgba(0,229,255,0.15);
  --radius: 16px;
  --radius-sm: 10px;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;overflow:hidden;}
h1,h2,h3,h4,.display{font-family:'Syne',sans-serif;}

/* SCROLLBAR */
::-webkit-scrollbar{width:4px;height:4px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}

/* LAYOUT */
#app{display:flex;flex-direction:column;height:100vh;position:relative;}
#screen{flex:1;overflow-y:auto;overflow-x:hidden;padding-bottom:80px;}
#navbar{position:fixed;bottom:0;left:0;right:0;background:rgba(8,12,16,0.95);backdrop-filter:blur(20px);border-top:1px solid var(--border);display:flex;z-index:100;}
.nav-item{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:10px 4px 14px;cursor:pointer;transition:all 0.2s;gap:4px;position:relative;}
.nav-item svg{width:22px;height:22px;stroke:var(--text3);transition:all 0.2s;}
.nav-item span{font-size:10px;color:var(--text3);font-family:'Syne',sans-serif;font-weight:500;transition:all 0.2s;}
.nav-item.active svg{stroke:var(--accent);}
.nav-item.active span{color:var(--accent);}
.nav-item.active::after{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:30px;height:2px;background:var(--accent);border-radius:0 0 4px 4px;}

/* HEADER */
.header{display:flex;align-items:center;justify-content:space-between;padding:18px 20px 10px;position:sticky;top:0;background:rgba(8,12,16,0.9);backdrop-filter:blur(20px);z-index:50;border-bottom:1px solid var(--border);}
.header-left{display:flex;align-items:center;gap:12px;}
.logo{font-family:'Syne',sans-serif;font-weight:800;font-size:20px;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.page-title{font-family:'Syne',sans-serif;font-weight:700;font-size:18px;}
.header-actions{display:flex;gap:10px;}
.icon-btn{width:38px;height:38px;border-radius:10px;background:var(--card);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s;}
.icon-btn:hover{background:var(--card2);border-color:var(--accent);}
.icon-btn svg{width:18px;height:18px;stroke:var(--text2);}

/* CARDS */
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:18px;}
.card-glass{background:rgba(17,24,32,0.6);backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:var(--radius);}

/* BADGE */
.badge{display:inline-flex;align-items:center;gap:5px;font-size:11px;font-weight:600;padding:4px 10px;border-radius:20px;font-family:'Syne',sans-serif;}
.badge-cyan{background:rgba(0,229,255,0.12);color:var(--accent);border:1px solid rgba(0,229,255,0.2);}
.badge-green{background:rgba(16,185,129,0.12);color:var(--accent3);border:1px solid rgba(16,185,129,0.2);}
.badge-purple{background:rgba(124,58,237,0.12);color:#a78bfa;border:1px solid rgba(124,58,237,0.2);}
.badge-amber{background:rgba(245,158,11,0.12);color:var(--accent4);border:1px solid rgba(245,158,11,0.2);}
.badge-red{background:rgba(239,68,68,0.12);color:var(--accent5);border:1px solid rgba(239,68,68,0.2);}

/* BUTTON */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 22px;border-radius:var(--radius-sm);font-family:'Syne',sans-serif;font-weight:600;font-size:14px;cursor:pointer;transition:all 0.2s;border:none;}
.btn-primary{background:linear-gradient(135deg,var(--accent),#0099cc);color:#000;}
.btn-primary:hover{transform:translateY(-1px);box-shadow:var(--glow);}
.btn-outline{background:transparent;border:1px solid var(--border);color:var(--text);}
.btn-outline:hover{border-color:var(--accent);color:var(--accent);}
.btn-sm{padding:8px 16px;font-size:13px;}
.btn-full{width:100%;}

/* INPUT */
.input-group{display:flex;flex-direction:column;gap:6px;margin-bottom:14px;}
.input-label{font-size:12px;font-weight:600;color:var(--text2);font-family:'Syne',sans-serif;text-transform:uppercase;letter-spacing:0.05em;}
.input{background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px 14px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;width:100%;transition:all 0.2s;outline:none;}
.input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(0,229,255,0.1);}
select.input option{background:var(--bg3);}

/* PROGRESS */
.progress-bar{height:6px;background:var(--bg3);border-radius:3px;overflow:hidden;}
.progress-fill{height:100%;border-radius:3px;transition:width 0.5s ease;}

/* RING */
.ring-container{position:relative;display:inline-flex;align-items:center;justify-content:center;}
.ring-text{position:absolute;text-align:center;}

/* AVATAR */
.avatar{border-radius:50%;object-fit:cover;background:linear-gradient(135deg,var(--accent2),var(--accent));display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:700;color:#fff;flex-shrink:0;}

/* SECTION */
.section{padding:0 16px;margin-bottom:24px;}
.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
.section-title{font-family:'Syne',sans-serif;font-weight:700;font-size:16px;}
.see-all{font-size:13px;color:var(--accent);cursor:pointer;font-weight:500;}

/* METRIC CARD */
.metric-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;display:flex;flex-direction:column;gap:6px;}
.metric-value{font-family:'Syne',sans-serif;font-weight:800;font-size:28px;}
.metric-label{font-size:12px;color:var(--text2);}
.metric-change{font-size:12px;font-weight:600;}
.metric-change.up{color:var(--accent3);}
.metric-change.down{color:var(--accent5);}

/* MODAL OVERLAY */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);backdrop-filter:blur(8px);z-index:200;display:flex;align-items:flex-end;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.3s;}
.overlay.open{opacity:1;pointer-events:all;}
.modal{background:var(--bg2);border:1px solid var(--border);border-radius:24px 24px 0 0;width:100%;max-width:480px;padding:24px;max-height:85vh;overflow-y:auto;transform:translateY(100%);transition:transform 0.35s cubic-bezier(0.34,1.56,0.64,1);}
.overlay.open .modal{transform:translateY(0);}
.modal-handle{width:40px;height:4px;background:var(--text3);border-radius:2px;margin:0 auto 20px;}
.modal-title{font-family:'Syne',sans-serif;font-weight:700;font-size:20px;margin-bottom:4px;}
.modal-subtitle{font-size:14px;color:var(--text2);margin-bottom:20px;}

/* TABS */
.tabs{display:flex;gap:4px;background:var(--bg3);border-radius:var(--radius-sm);padding:4px;margin-bottom:18px;}
.tab{flex:1;padding:8px;text-align:center;font-family:'Syne',sans-serif;font-size:12px;font-weight:600;cursor:pointer;border-radius:7px;transition:all 0.2s;color:var(--text2);}
.tab.active{background:var(--card2);color:var(--accent);}

/* TOGGLE */
.toggle-group{display:flex;gap:4px;}
.toggle-item{flex:1;padding:10px 8px;text-align:center;border-radius:var(--radius-sm);font-size:12px;font-weight:600;font-family:'Syne',sans-serif;cursor:pointer;transition:all 0.2s;border:1px solid var(--border);color:var(--text2);}
.toggle-item.active{background:rgba(0,229,255,0.1);border-color:var(--accent);color:var(--accent);}

/* EXERCISE CARD */
.exercise-item{display:flex;align-items:center;gap:14px;padding:14px;background:var(--card);border:1px solid var(--border);border-radius:var(--radius-sm);cursor:pointer;transition:all 0.2s;margin-bottom:8px;}
.exercise-item:hover{border-color:var(--accent);background:var(--card2);}
.exercise-thumb{width:52px;height:52px;border-radius:10px;background:linear-gradient(135deg,var(--accent2),var(--accent));display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;}
.exercise-name{font-family:'Syne',sans-serif;font-weight:600;font-size:14px;}
.exercise-focus{font-size:12px;color:var(--text2);margin-top:3px;}

/* CHART BARS */
.chart-bars{display:flex;align-items:flex-end;gap:6px;height:80px;}
.bar-wrap{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;}
.bar{width:100%;background:linear-gradient(180deg,var(--accent),rgba(0,229,255,0.2));border-radius:4px 4px 0 0;transition:height 0.5s ease;min-height:4px;}
.bar-label{font-size:9px;color:var(--text3);}

/* FOOD LOG */
.food-item{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;background:var(--card);border:1px solid var(--border);border-radius:var(--radius-sm);margin-bottom:6px;}
.food-name{font-size:14px;font-weight:500;}
.food-cal{font-family:'Syne',sans-serif;font-weight:700;font-size:14px;color:var(--accent);}
.food-macro{font-size:11px;color:var(--text2);}

/* CHALLENGE */
.challenge-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;position:relative;overflow:hidden;}
.challenge-card::before{content:'';position:absolute;top:-30px;right:-30px;width:100px;height:100px;background:radial-gradient(circle,rgba(0,229,255,0.08),transparent 70%);border-radius:50%;}

/* ACCOUNT SWITCHER */
.account-item{display:flex;align-items:center;gap:12px;padding:14px;border-radius:var(--radius-sm);cursor:pointer;transition:all 0.2s;border:1px solid transparent;}
.account-item:hover{background:var(--card);border-color:var(--border);}
.account-item.active-account{background:rgba(0,229,255,0.06);border-color:rgba(0,229,255,0.2);}
.account-check{margin-left:auto;color:var(--accent);}

/* SCAN AREA */
.scan-area{background:var(--card);border:2px dashed var(--border);border-radius:var(--radius);padding:32px 20px;text-align:center;cursor:pointer;transition:all 0.3s;}
.scan-area:hover{border-color:var(--accent);background:rgba(0,229,255,0.03);}
.scan-icon{width:64px;height:64px;margin:0 auto 16px;background:linear-gradient(135deg,rgba(0,229,255,0.15),rgba(124,58,237,0.15));border-radius:50%;display:flex;align-items:center;justify-content:center;}
.scan-icon svg{width:32px;height:32px;stroke:var(--accent);}

/* MACRO PILLS */
.macro-row{display:flex;gap:8px;}
.macro-pill{flex:1;background:var(--bg3);border-radius:var(--radius-sm);padding:10px 12px;text-align:center;}
.macro-pill-val{font-family:'Syne',sans-serif;font-weight:700;font-size:18px;}
.macro-pill-label{font-size:11px;color:var(--text2);margin-top:2px;}

/* STEP CIRCLE */
.step-circle{width:160px;height:160px;margin:0 auto;}

/* MUSCLE MAP */
.muscle-map{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.muscle-zone{background:var(--bg3);border-radius:var(--radius-sm);padding:10px;text-align:center;}
.muscle-zone-bar{height:4px;border-radius:2px;margin-top:6px;}
.muscle-zone-name{font-size:11px;color:var(--text2);}
.muscle-zone-pct{font-family:'Syne',sans-serif;font-weight:700;font-size:16px;}

/* NOTIFICATION DOT */
.notif-dot{position:absolute;top:2px;right:2px;width:8px;height:8px;background:var(--accent5);border-radius:50%;border:2px solid var(--bg);}

/* MACRO CIRCLE SVG */
svg.macro-ring text{font-family:'Syne',sans-serif;}

/* TIMER */
.timer-display{font-family:'Syne',sans-serif;font-weight:800;font-size:48px;text-align:center;color:var(--accent);letter-spacing:-2px;}

/* FLOATING ACTION */
.fab{position:fixed;bottom:96px;right:16px;width:52px;height:52px;background:linear-gradient(135deg,var(--accent),#0099cc);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 4px 20px rgba(0,229,255,0.3);z-index:90;transition:all 0.2s;}
.fab:hover{transform:scale(1.05);}
.fab svg{width:24px;height:24px;stroke:#000;}

/* SKIN */
.skin-dot{width:12px;height:12px;border-radius:50%;display:inline-block;margin-right:6px;}

/* ANIMATE IN */
@keyframes fadeUp{from{opacity:0;transform:translateY(12px);}to{opacity:1;transform:translateY(0);}}
.animate-in{animation:fadeUp 0.35s ease forwards;}

/* GLOW PULSE */
@keyframes pulse-glow{0%,100%{box-shadow:0 0 0 0 rgba(0,229,255,0.3);}50%{box-shadow:0 0 20px 6px rgba(0,229,255,0.15);}}
.pulse-glow{animation:pulse-glow 2s ease-in-out infinite;}

/* SPLASH / LOGIN */
#splash{position:fixed;inset:0;background:var(--bg);z-index:1000;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;}
.splash-logo{font-family:'Syne',sans-serif;font-weight:800;font-size:36px;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.splash-tagline{font-size:14px;color:var(--text2);}
#splash.hide{animation:fadeOut 0.4s ease forwards;}
@keyframes fadeOut{to{opacity:0;pointer-events:none;}}

/* AI TYPING */
.ai-bubble{background:var(--card);border:1px solid var(--border);border-radius:0 16px 16px 16px;padding:14px;max-width:85%;margin-bottom:8px;}
.user-bubble{background:rgba(0,229,255,0.1);border:1px solid rgba(0,229,255,0.2);border-radius:16px 0 16px 16px;padding:14px;max-width:85%;margin-left:auto;margin-bottom:8px;}
.typing-indicator span{display:inline-block;width:6px;height:6px;background:var(--text3);border-radius:50%;margin:0 2px;animation:bounce 1.2s infinite;}
.typing-indicator span:nth-child(2){animation-delay:0.2s;}
.typing-indicator span:nth-child(3){animation-delay:0.4s;}
@keyframes bounce{0%,60%,100%{transform:translateY(0);}30%{transform:translateY(-6px);}}

/* GRID 2 */
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;}

/* SEPARATOR */
.sep{height:1px;background:var(--border);margin:16px 0;}

/* TAG */
.tag{display:inline-flex;align-items:center;background:var(--bg3);border:1px solid var(--border);border-radius:20px;padding:4px 12px;font-size:12px;color:var(--text2);cursor:pointer;transition:all 0.2s;}
.tag:hover,.tag.selected{background:rgba(0,229,255,0.1);border-color:var(--accent);color:var(--accent);}

/* WORKOUT LOG ROW */
.set-row{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid var(--border);}
.set-row:last-child{border-bottom:none;}
.set-num{width:24px;height:24px;background:var(--bg3);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;font-family:'Syne',sans-serif;color:var(--text2);}

/* SCROLLABLE ROW */
.scroll-row{display:flex;gap:10px;overflow-x:auto;padding-bottom:4px;scrollbar-width:none;}
.scroll-row::-webkit-scrollbar{display:none;}
</style>
</head>
<body>

<!-- SPLASH -->
<div id="splash">
  <div class="splash-logo">VITALIS AI</div>
  <div class="splash-tagline">Tu asistente de salud inteligente</div>
</div>

<!-- LOGIN OVERLAY -->
<div class="overlay" id="loginOverlay">
<div class="modal">
  <div class="modal-handle"></div>
  <div id="loginView">
    <div class="modal-title">Bienvenido de nuevo</div>
    <div class="modal-subtitle">Inicia sesi√≥n en tu cuenta</div>
    <div class="input-group">
      <div class="input-label">Email</div>
      <input class="input" type="email" placeholder="tu@email.com" id="loginEmail">
    </div>
    <div class="input-group">
      <div class="input-label">Contrase√±a</div>
      <input class="input" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" id="loginPass">
    </div>
    <button class="btn btn-primary btn-full" style="margin-top:8px;" onclick="doLogin()">Entrar</button>
    <div style="text-align:center;margin-top:16px;font-size:14px;color:var(--text2);">¬øNo tienes cuenta? <span style="color:var(--accent);cursor:pointer;" onclick="showRegister()">Reg√≠strate</span></div>
  </div>
  <div id="registerView" style="display:none;">
    <div class="modal-title">Crear cuenta</div>
    <div class="modal-subtitle">√önete a Vitalis AI</div>
    <div class="input-group">
      <div class="input-label">Nombre</div>
      <input class="input" type="text" placeholder="Tu nombre" id="regName">
    </div>
    <div class="input-group">
      <div class="input-label">Email</div>
      <input class="input" type="email" placeholder="tu@email.com" id="regEmail">
    </div>
    <div class="input-group">
      <div class="input-label">Contrase√±a</div>
      <input class="input" type="password" placeholder="M√≠n. 6 caracteres" id="regPass">
    </div>
    <div class="grid2" style="gap:10px;margin-bottom:14px;">
      <div class="input-group" style="margin:0;">
        <div class="input-label">Peso (kg)</div>
        <input class="input" type="number" placeholder="75" id="regWeight">
      </div>
      <div class="input-group" style="margin:0;">
        <div class="input-label">Altura (cm)</div>
        <input class="input" type="number" placeholder="175" id="regHeight">
      </div>
    </div>
    <div class="input-group">
      <div class="input-label">Objetivo</div>
      <select class="input" id="regGoal">
        <option value="bulk">Ganar m√∫sculo</option>
        <option value="cut">Perder grasa</option>
        <option value="maintain">Mantener peso</option>
        <option value="health">Mejorar salud general</option>
      </select>
    </div>
    <button class="btn btn-primary btn-full" style="margin-top:8px;" onclick="doRegister()">Crear cuenta</button>
    <div style="text-align:center;margin-top:16px;font-size:14px;color:var(--text2);">¬øYa tienes cuenta? <span style="color:var(--accent);cursor:pointer;" onclick="showLogin()">Inicia sesi√≥n</span></div>
  </div>
</div>
</div>

<!-- ACCOUNT SWITCHER OVERLAY -->
<div class="overlay" id="accountOverlay">
<div class="modal">
  <div class="modal-handle"></div>
  <div class="modal-title">Cambiar de cuenta</div>
  <div class="modal-subtitle">Selecciona o a√±ade una cuenta</div>
  <div id="accountList"></div>
  <div class="sep"></div>
  <button class="btn btn-outline btn-full" onclick="showAddAccount()">
    <svg viewBox="0 0 24 24" fill="none" width="18" height="18"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/><path d="M12 8v8M8 12h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
    Agregar cuenta
  </button>
  <button class="btn btn-outline btn-full" style="margin-top:8px;" onclick="doLogout()">
    <svg viewBox="0 0 24 24" fill="none" width="18" height="18"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    Cerrar sesi√≥n
  </button>
</div>
</div>

<!-- ADD ACCOUNT OVERLAY -->
<div class="overlay" id="addAccountOverlay">
<div class="modal">
  <div class="modal-handle"></div>
  <div class="modal-title">Agregar cuenta</div>
  <div class="modal-subtitle">Ingresa los datos de la nueva cuenta</div>
  <div class="input-group">
    <div class="input-label">Nombre</div>
    <input class="input" type="text" placeholder="Nombre de la cuenta" id="newAccName">
  </div>
  <div class="input-group">
    <div class="input-label">Email</div>
    <input class="input" type="email" placeholder="email@ejemplo.com" id="newAccEmail">
  </div>
  <div class="input-group">
    <div class="input-label">Contrase√±a</div>
    <input class="input" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" id="newAccPass">
  </div>
  <button class="btn btn-primary btn-full" style="margin-top:8px;" onclick="addNewAccount()">Agregar cuenta</button>
  <button class="btn btn-outline btn-full" style="margin-top:8px;" onclick="closeAddAccount()">Cancelar</button>
</div>
</div>

<!-- MAIN APP -->
<div id="app" style="display:none;">
  <div id="screen">
    <!-- HOME -->
    <div id="page-home" class="page">
      <div class="header">
        <div class="header-left">
          <div class="logo">VITALIS</div>
        </div>
        <div class="header-actions">
          <div class="icon-btn" onclick="openAccountSwitcher()" style="position:relative;">
            <div id="currentAvatar" class="avatar" style="width:28px;height:28px;font-size:11px;"></div>
          </div>
          <div class="icon-btn" style="position:relative;">
            <svg viewBox="0 0 24 24" fill="none"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            <div class="notif-dot"></div>
          </div>
        </div>
      </div>

      <div style="padding:20px 16px 0;">
        <div style="font-size:13px;color:var(--text2);margin-bottom:4px;">Buenas tardes,</div>
        <div style="font-family:'Syne',sans-serif;font-weight:800;font-size:24px;" id="homeUserName">Usuario</div>
        <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap;" id="homeGoalBadge"></div>
      </div>

      <!-- DAILY RINGS -->
      <div class="section" style="margin-top:20px;">
        <div class="section-header">
          <div class="section-title">Hoy</div>
          <span class="see-all">Ver detalles</span>
        </div>
        <div class="grid3">
          <div class="metric-card" style="align-items:center;">
            <svg width="40" height="40" viewBox="0 0 40 40"><circle cx="20" cy="20" r="16" fill="none" stroke="var(--bg3)" stroke-width="4"/><circle cx="20" cy="20" r="16" fill="none" stroke="var(--accent5)" stroke-width="4" stroke-dasharray="100.5" stroke-dashoffset="35" stroke-linecap="round" transform="rotate(-90 20 20)"/></svg>
            <div class="metric-value" style="font-size:20px;">1,840</div>
            <div class="metric-label" style="text-align:center;">kcal<br>restantes</div>
          </div>
          <div class="metric-card" style="align-items:center;">
            <svg width="40" height="40" viewBox="0 0 40 40"><circle cx="20" cy="20" r="16" fill="none" stroke="var(--bg3)" stroke-width="4"/><circle cx="20" cy="20" r="16" fill="none" stroke="var(--accent3)" stroke-width="4" stroke-dasharray="100.5" stroke-dashoffset="60" stroke-linecap="round" transform="rotate(-90 20 20)"/></svg>
            <div class="metric-value" style="font-size:20px;" id="stepsDisplay">6,230</div>
            <div class="metric-label" style="text-align:center;">pasos<br>hoy</div>
          </div>
          <div class="metric-card" style="align-items:center;">
            <svg width="40" height="40" viewBox="0 0 40 40"><circle cx="20" cy="20" r="16" fill="none" stroke="var(--bg3)" stroke-width="4"/><circle cx="20" cy="20" r="16" fill="none" stroke="var(--accent2)" stroke-width="4" stroke-dasharray="100.5" stroke-dashoffset="80" stroke-linecap="round" transform="rotate(-90 20 20)"/></svg>
            <div class="metric-value" style="font-size:20px;">1.8L</div>
            <div class="metric-label" style="text-align:center;">agua<br>bebida</div>
          </div>
        </div>
      </div>

      <!-- NEXT WORKOUT -->
      <div class="section">
        <div class="section-header">
          <div class="section-title">Pr√≥ximo entrenamiento</div>
        </div>
        <div class="card" style="background:linear-gradient(135deg,rgba(124,58,237,0.15),rgba(0,229,255,0.05));border-color:rgba(124,58,237,0.3);">
          <div style="display:flex;align-items:center;justify-content:space-between;">
            <div>
              <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:18px;">Push Day üí™</div>
              <div style="font-size:13px;color:var(--text2);margin-top:4px;">Pecho ¬∑ Hombros ¬∑ Tr√≠ceps</div>
              <div style="display:flex;gap:8px;margin-top:10px;">
                <span class="badge badge-purple">8 ejercicios</span>
                <span class="badge badge-cyan">~55 min</span>
              </div>
            </div>
            <button class="btn btn-primary btn-sm" onclick="navigate('exercise')">Iniciar</button>
          </div>
        </div>
      </div>

      <!-- WEEKLY CHART -->
      <div class="section">
        <div class="section-header">
          <div class="section-title">Pasos esta semana</div>
        </div>
        <div class="card">
          <div class="chart-bars">
            <div class="bar-wrap"><div class="bar" style="height:45px;"></div><div class="bar-label">L</div></div>
            <div class="bar-wrap"><div class="bar" style="height:62px;"></div><div class="bar-label">M</div></div>
            <div class="bar-wrap"><div class="bar" style="height:35px;"></div><div class="bar-label">X</div></div>
            <div class="bar-wrap"><div class="bar" style="height:70px;"></div><div class="bar-label">J</div></div>
            <div class="bar-wrap"><div class="bar" style="height:50px;"></div><div class="bar-label">V</div></div>
            <div class="bar-wrap"><div class="bar" style="height:30px;background:linear-gradient(180deg,var(--accent3),rgba(16,185,129,0.2));"></div><div class="bar-label">S</div></div>
            <div class="bar-wrap"><div class="bar" style="height:48px;opacity:0.4;"></div><div class="bar-label">D</div></div>
          </div>
        </div>
      </div>

      <!-- QUICK ACTIONS -->
      <div class="section">
        <div class="section-title" style="margin-bottom:12px;">Acciones r√°pidas</div>
        <div class="grid2">
          <div class="card" style="cursor:pointer;text-align:center;" onclick="navigate('nutrition')">
            <div style="font-size:28px;margin-bottom:8px;">ü•ó</div>
            <div style="font-family:'Syne',sans-serif;font-weight:600;font-size:13px;">Registrar comida</div>
          </div>
          <div class="card" style="cursor:pointer;text-align:center;" onclick="navigate('scan')">
            <div style="font-size:28px;margin-bottom:8px;">üî¨</div>
            <div style="font-family:'Syne',sans-serif;font-weight:600;font-size:13px;">Escaneo corporal</div>
          </div>
          <div class="card" style="cursor:pointer;text-align:center;" onclick="navigate('style')">
            <div style="font-size:28px;margin-bottom:8px;">üíà</div>
            <div style="font-family:'Syne',sans-serif;font-weight:600;font-size:13px;">Estilo personal</div>
          </div>
          <div class="card" style="cursor:pointer;text-align:center;" onclick="openAIChat()">
            <div style="font-size:28px;margin-bottom:8px;">ü§ñ</div>
            <div style="font-family:'Syne',sans-serif;font-weight:600;font-size:13px;">Chat con IA</div>
          </div>
        </div>
      </div>

      <!-- MOOD CHECK -->
      <div class="section">
        <div class="section-title" style="margin-bottom:12px;">¬øC√≥mo te sientes hoy?</div>
        <div class="card">
          <div style="display:flex;justify-content:space-around;">
            <div style="text-align:center;cursor:pointer;" onclick="selectMood(this,'üò´')"><div style="font-size:30px;">üò´</div><div style="font-size:10px;color:var(--text3);margin-top:4px;">Agotado</div></div>
            <div style="text-align:center;cursor:pointer;" onclick="selectMood(this,'üòê')"><div style="font-size:30px;">üòê</div><div style="font-size:10px;color:var(--text3);margin-top:4px;">Normal</div></div>
            <div style="text-align:center;cursor:pointer;" onclick="selectMood(this,'üôÇ')"><div style="font-size:30px;">üôÇ</div><div style="font-size:10px;color:var(--text3);margin-top:4px;">Bien</div></div>
            <div style="text-align:center;cursor:pointer;" onclick="selectMood(this,'‚ö°')"><div style="font-size:30px;">‚ö°</div><div style="font-size:10px;color:var(--text3);margin-top:4px;">¬°Energ√≠a!</div></div>
          </div>
        </div>
      </div>

      <!-- CHALLENGES -->
      <div class="section">
        <div class="section-header">
          <div class="section-title">Reto del mes</div>
          <span class="badge badge-amber">üèÜ Activo</span>
        </div>
        <div class="challenge-card">
          <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:16px;">Correr 50km en febrero</div>
          <div style="font-size:13px;color:var(--text2);margin-top:4px;">24.5 / 50 km completados</div>
          <div class="progress-bar" style="margin-top:12px;">
            <div class="progress-fill" style="width:49%;background:linear-gradient(90deg,var(--accent3),var(--accent));"></div>
          </div>
          <div style="display:flex;justify-content:space-between;margin-top:6px;font-size:11px;color:var(--text3);">
            <span>49% completado</span><span>25.5 km restantes</span>
          </div>
        </div>
      </div>
    </div>

    <!-- NUTRITION PAGE -->
    <div id="page-nutrition" class="page" style="display:none;">
      <div class="header">
        <div class="page-title">Nutrici√≥n</div>
        <div class="header-actions">
          <div class="icon-btn" onclick="openFoodSearch()">
            <svg viewBox="0 0 24 24" fill="none"><circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/><path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          </div>
          <div class="icon-btn" onclick="openFoodScan()">
            <svg viewBox="0 0 24 24" fill="none"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="13" r="4" stroke="currentColor" stroke-width="2"/></svg>
          </div>
        </div>
      </div>

      <div style="padding:16px;">
        <!-- CALORIE RING -->
        <div class="card" style="text-align:center;padding:20px;">
          <svg width="140" height="140" viewBox="0 0 140 140" style="margin:0 auto;display:block;">
            <circle cx="70" cy="70" r="58" fill="none" stroke="var(--bg3)" stroke-width="10"/>
            <circle cx="70" cy="70" r="58" fill="none" stroke="var(--accent5)" stroke-width="10" stroke-dasharray="364.4" stroke-dashoffset="220" stroke-linecap="round" transform="rotate(-90 70 70)"/>
            <text x="70" y="62" text-anchor="middle" fill="var(--text)" font-family="Syne" font-weight="800" font-size="26">1,460</text>
            <text x="70" y="80" text-anchor="middle" fill="var(--text2)" font-family="DM Sans" font-size="12">de 2,400 kcal</text>
            <text x="70" y="96" text-anchor="middle" fill="var(--text3)" font-family="DM Sans" font-size="11">940 restantes</text>
          </svg>
          <div class="macro-row" style="margin-top:16px;">
            <div class="macro-pill">
              <div class="macro-pill-val" style="color:#60a5fa;">87g</div>
              <div class="macro-pill-label">Prote√≠na</div>
              <div class="progress-bar" style="margin-top:6px;height:3px;">
                <div class="progress-fill" style="width:62%;background:#60a5fa;"></div>
              </div>
            </div>
            <div class="macro-pill">
              <div class="macro-pill-val" style="color:var(--accent4);">165g</div>
              <div class="macro-pill-label">Carbos</div>
              <div class="progress-bar" style="margin-top:6px;height:3px;">
                <div class="progress-fill" style="width:55%;background:var(--accent4);"></div>
              </div>
            </div>
            <div class="macro-pill">
              <div class="macro-pill-val" style="color:var(--accent3);">48g</div>
              <div class="macro-pill-label">Grasa</div>
              <div class="progress-bar" style="margin-top:6px;height:3px;">
                <div class="progress-fill" style="width:70%;background:var(--accent3);"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- MEALS -->
        <div id="mealsContainer"></div>

        <!-- WATER -->
        <div class="card" style="margin-top:16px;">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
            <div style="font-family:'Syne',sans-serif;font-weight:600;">üíß Agua</div>
            <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:16px;color:var(--accent);">1.8 / 2.5L</div>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width:72%;background:linear-gradient(90deg,#38bdf8,var(--accent));"></div>
          </div>
          <div style="display:flex;gap:6px;margin-top:12px;">
            <button class="btn btn-outline btn-sm" style="flex:1;" onclick="addWater(250)">+250ml</button>
            <button class="btn btn-outline btn-sm" style="flex:1;" onclick="addWater(500)">+500ml</button>
            <button class="btn btn-primary btn-sm" style="flex:1;">+1L</button>
          </div>
        </div>

        <!-- RECIPE AI -->
        <div class="card" style="margin-top:16px;background:linear-gradient(135deg,rgba(16,185,129,0.08),transparent);">
          <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:15px;margin-bottom:6px;">üç≥ Receta sugerida por IA</div>
          <div style="font-size:13px;color:var(--text2);margin-bottom:12px;">Basado en tus 940 kcal restantes y tu objetivo de ganancia muscular</div>
          <div style="font-family:'Syne',sans-serif;font-weight:600;font-size:16px;">Pechuga de pollo con quinoa y aguacate</div>
          <div style="font-size:13px;color:var(--text2);margin-top:4px;">~480 kcal ¬∑ 42g prote√≠na ¬∑ 35g carbos ¬∑ 14g grasa</div>
          <button class="btn btn-outline btn-sm" style="margin-top:12px;">Ver receta completa ‚Üí</button>
        </div>
      </div>
    </div>

    <!-- EXERCISE PAGE -->
    <div id="page-exercise" class="page" style="display:none;">
      <div class="header">
        <div class="page-title">Ejercicio</div>
        <div class="header-actions">
          <div class="icon-btn" onclick="openAIRoutineBuilder()">
            <svg viewBox="0 0 24 24" fill="none"><path d="M12 2a10 10 0 100 20A10 10 0 0012 2z" stroke="currentColor" stroke-width="2"/><path d="M12 8v4l3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          </div>
        </div>
      </div>

      <div style="padding:16px;">
        <div class="tabs" id="exerciseTabs">
          <div class="tab active" onclick="switchExTab(this,'tabRoutines')">Rutinas</div>
          <div class="tab" onclick="switchExTab(this,'tabExercises')">Ejercicios</div>
          <div class="tab" onclick="switchExTab(this,'tabCalculators')">Calculadoras</div>
          <div class="tab" onclick="switchExTab(this,'tabSupplements')">Suplementos</div>
        </div>

        <!-- ROUTINES -->
        <div id="tabRoutines">
          <button class="btn btn-primary btn-full" style="margin-bottom:14px;" onclick="openAIRoutineBuilder()">
            <svg viewBox="0 0 24 24" fill="none" width="18" height="18"><path d="M12 2a10 10 0 100 20A10 10 0 0012 2z" stroke="currentColor" stroke-width="2"/><path d="M8 12h8M12 8v8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            Crear rutina con IA
          </button>
          <div id="routinesList"></div>
        </div>

        <!-- EXERCISES DB -->
        <div id="tabExercises" style="display:none;">
          <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px;" id="muscleGroupTags"></div>
          <div id="exercisesList"></div>
        </div>

        <!-- CALCULATORS -->
        <div id="tabCalculators" style="display:none;">
          <div class="card" style="margin-bottom:14px;">
            <div style="font-family:'Syne',sans-serif;font-weight:700;margin-bottom:12px;">Calculadora 1RM</div>
            <div class="input-group">
              <div class="input-label">Peso levantado (kg)</div>
              <input class="input" type="number" placeholder="100" id="rmWeight">
            </div>
            <div class="input-group">
              <div class="input-label">Repeticiones</div>
              <input class="input" type="number" placeholder="5" id="rmReps">
            </div>
            <button class="btn btn-primary btn-sm btn-full" onclick="calc1RM()">Calcular</button>
            <div id="rmResult" style="text-align:center;margin-top:12px;font-family:'Syne',sans-serif;font-weight:700;font-size:24px;color:var(--accent);display:none;"></div>
          </div>
          <div class="card">
            <div style="font-family:'Syne',sans-serif;font-weight:700;margin-bottom:12px;">Tasa Metab√≥lica Basal (TMB)</div>
            <div class="grid2" style="gap:10px;margin-bottom:10px;">
              <div class="input-group" style="margin:0;">
                <div class="input-label">Peso (kg)</div>
                <input class="input" type="number" placeholder="75" id="tmbPeso">
              </div>
              <div class="input-group" style="margin:0;">
                <div class="input-label">Altura (cm)</div>
                <input class="input" type="number" placeholder="175" id="tmbAltura">
              </div>
            </div>
            <div class="grid2" style="gap:10px;margin-bottom:10px;">
              <div class="input-group" style="margin:0;">
                <div class="input-label">Edad</div>
                <input class="input" type="number" placeholder="25" id="tmbEdad">
              </div>
              <div class="input-group" style="margin:0;">
                <div class="input-label">Sexo</div>
                <select class="input" id="tmbSexo">
                  <option value="m">Masculino</option>
                  <option value="f">Femenino</option>
                </select>
              </div>
            </div>
            <button class="btn btn-primary btn-sm btn-full" onclick="calcTMB()">Calcular TMB</button>
            <div id="tmbResult" style="display:none;margin-top:12px;"></div>
          </div>
        </div>

        <!-- SUPPLEMENTS -->
        <div id="tabSupplements" style="display:none;">
          <div id="supplementsList"></div>
        </div>
      </div>
    </div>

    <!-- SCAN PAGE -->
    <div id="page-scan" class="page" style="display:none;">
      <div class="header">
        <div class="page-title">Escaneo IA</div>
      </div>
      <div style="padding:16px;">
        <div class="tabs">
          <div class="tab active" onclick="switchScanTab(this,'scanBody')">Corporal</div>
          <div class="tab" onclick="switchScanTab(this,'scanFace')">Facial</div>
          <div class="tab" onclick="switchScanTab(this,'scanHistory')">Historial</div>
        </div>

        <!-- BODY SCAN -->
        <div id="scanBody">
          <div class="scan-area" onclick="simulateScan('body')">
            <div class="scan-icon"><svg viewBox="0 0 24 24" fill="none"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2" stroke="currentColor" stroke-width="2"/><circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></div>
            <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:16px;">Iniciar escaneo corporal</div>
            <div style="font-size:13px;color:var(--text2);margin-top:6px;">Col√≥cate de frente, lateral y de espaldas</div>
            <div style="display:flex;gap:8px;justify-content:center;margin-top:12px;">
              <span class="badge badge-cyan">Composici√≥n corporal</span>
              <span class="badge badge-purple">Mapa muscular</span>
            </div>
          </div>

          <div id="bodyScanResults" style="display:none;">
            <div class="card" style="margin-top:16px;">
              <div style="font-family:'Syne',sans-serif;font-weight:700;margin-bottom:14px;">Composici√≥n corporal</div>
              <div class="grid3">
                <div style="text-align:center;">
                  <div style="font-family:'Syne',sans-serif;font-weight:800;font-size:24px;color:var(--accent5);">18.4%</div>
                  <div style="font-size:11px;color:var(--text2);">Grasa</div>
                </div>
                <div style="text-align:center;">
                  <div style="font-family:'Syne',sans-serif;font-weight:800;font-size:24px;color:var(--accent3);">42.1%</div>
                  <div style="font-size:11px;color:var(--text2);">M√∫sculo</div>
                </div>
                <div style="text-align:center;">
                  <div style="font-family:'Syne',sans-serif;font-weight:800;font-size:24px;color:#60a5fa;">61.2%</div>
                  <div style="font-size:11px;color:var(--text2);">Agua</div>
                </div>
              </div>
            </div>

            <div class="card" style="margin-top:12px;">
              <div style="font-family:'Syne',sans-serif;font-weight:700;margin-bottom:14px;">Mapa muscular</div>
              <div class="muscle-map" id="muscleMapGrid"></div>
            </div>

            <div class="card" style="margin-top:12px;">
              <div style="font-family:'Syne',sans-serif;font-weight:700;margin-bottom:12px;">Per√≠metros</div>
              <div id="perimetersList"></div>
            </div>

            <div class="card" style="margin-top:12px;background:rgba(245,158,11,0.05);border-color:rgba(245,158,11,0.2);">
              <div style="font-family:'Syne',sans-serif;font-weight:600;font-size:14px;color:var(--accent4);margin-bottom:6px;">‚ö†Ô∏è An√°lisis postural</div>
              <div style="font-size:13px;color:var(--text2);">Leve inclinaci√≥n en hombro derecho detectada. Posible hipercifosis en zona dorsal. <b style="color:var(--text)">Esto no sustituye un diagn√≥stico m√©dico.</b></div>
            </div>
          </div>
        </div>

        <!-- FACE SCAN -->
        <div id="scanFace" style="display:none;">
          <div class="scan-area" onclick="simulateScan('face')">
            <div class="scan-icon"><svg viewBox="0 0 24 24" fill="none"><path d="M9 9h.01M15 9h.01M12 20c4.418 0 8-3.582 8-8S16.418 4 12 4 4 7.582 4 12s3.582 8 8 8z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M9 14s1 2 3 2 3-2 3-2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></div>
            <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:16px;">Escaneo facial</div>
            <div style="font-size:13px;color:var(--text2);margin-top:6px;">An√°lisis de simetr√≠a, piel y looksmaxing</div>
            <div style="display:flex;gap:8px;justify-content:center;margin-top:12px;flex-wrap:wrap;">
              <span class="badge badge-cyan">Simetr√≠a</span>
              <span class="badge badge-green">Piel</span>
              <span class="badge badge-purple">Looksmaxing</span>
            </div>
          </div>

          <div id="faceScanResults" style="display:none;">
            <div class="card" style="margin-top:16px;">
              <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
                <div style="font-family:'Syne',sans-serif;font-weight:700;">Puntuaci√≥n facial</div>
                <div style="font-family:'Syne',sans-serif;font-weight:800;font-size:32px;color:var(--accent);">7.8<span style="font-size:14px;color:var(--text2)">/10</span></div>
              </div>
              <div id="facialMetrics"></div>
            </div>
            <div class="card" style="margin-top:12px;">
              <div style="font-family:'Syne',sans-serif;font-weight:700;margin-bottom:12px;">üß¥ Rutina de Skincare personalizada</div>
              <div id="skincareRoutine"></div>
            </div>
            <div class="card" style="margin-top:12px;">
              <div style="font-family:'Syne',sans-serif;font-weight:700;margin-bottom:12px;">üí™ Ejercicios faciales</div>
              <div id="facialExercises"></div>
            </div>
          </div>
        </div>

        <!-- HISTORY -->
        <div id="scanHistory" style="display:none;">
          <div id="scanHistoryList"></div>
        </div>
      </div>
    </div>

    <!-- STEPS PAGE -->
    <div id="page-steps" class="page" style="display:none;">
      <div class="header">
        <div class="page-title">Actividad</div>
        <div class="header-actions">
          <div class="icon-btn" onclick="startGPSActivity()">
            <svg viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/><polygon points="10,8 16,12 10,16 10,8" fill="currentColor"/></svg>
          </div>
        </div>
      </div>
      <div style="padding:16px;">
        <!-- BIG STEPS NUMBER -->
        <div class="card" style="text-align:center;padding:32px 20px;">
          <div style="font-family:'Syne',sans-serif;font-weight:800;font-size:64px;line-height:1;background:linear-gradient(135deg,var(--accent),var(--accent3));-webkit-background-clip:text;-webkit-text-fill-color:transparent;" id="bigSteps">6,230</div>
          <div style="font-size:14px;color:var(--text2);margin:8px 0 20px;">de 10,000 pasos objetivo</div>
          <div class="progress-bar" style="height:10px;border-radius:5px;">
            <div class="progress-fill" style="width:62%;background:linear-gradient(90deg,var(--accent3),var(--accent));border-radius:5px;"></div>
          </div>
          <div class="grid3" style="margin-top:24px;gap:12px;">
            <div><div style="font-family:'Syne',sans-serif;font-weight:700;font-size:20px;">4.8</div><div style="font-size:11px;color:var(--text2);">km</div></div>
            <div><div style="font-family:'Syne',sans-serif;font-weight:700;font-size:20px;">312</div><div style="font-size:11px;color:var(--text2);">kcal activas</div></div>
            <div><div style="font-family:'Syne',sans-serif;font-weight:700;font-size:20px;">68min</div><div style="font-size:11px;color:var(--text2);">activo</div></div>
          </div>
        </div>

        <!-- WEEKLY BARS -->
        <div class="card" style="margin-top:14px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;margin-bottom:14px;">Esta semana</div>
          <div class="chart-bars">
            <div class="bar-wrap"><div class="bar" style="height:56px;"></div><div class="bar-label">L<br><span style="font-size:8px;">8.2k</span></div></div>
            <div class="bar-wrap"><div class="bar" style="height:72px;"></div><div class="bar-label">M<br><span style="font-size:8px;">10.5k</span></div></div>
            <div class="bar-wrap"><div class="bar" style="height:42px;"></div><div class="bar-label">X<br><span style="font-size:8px;">6.1k</span></div></div>
            <div class="bar-wrap"><div class="bar" style="height:68px;"></div><div class="bar-label">J<br><span style="font-size:8px;">9.9k</span></div></div>
            <div class="bar-wrap"><div class="bar" style="height:38px;background:linear-gradient(180deg,var(--accent3),rgba(16,185,129,0.2));"></div><div class="bar-label">V<br><span style="font-size:8px;">5.5k</span></div></div>
            <div class="bar-wrap"><div class="bar" style="height:44px;"></div><div class="bar-label">S<br><span style="font-size:8px;">6.2k</span></div></div>
            <div class="bar-wrap"><div class="bar" style="height:20px;opacity:0.3;"></div><div class="bar-label">D<br><span style="font-size:8px;">---</span></div></div>
          </div>
        </div>

        <!-- GPS ACTIVITY -->
        <div class="card" style="margin-top:14px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;margin-bottom:12px;">üèÉ Actividad GPS</div>
          <div id="gpsActivityStatus" style="text-align:center;padding:20px;color:var(--text2);font-size:14px;">
            Inicia una actividad con GPS para ver tu ruta y m√©tricas en tiempo real
          </div>
          <button class="btn btn-primary btn-full" onclick="startGPSActivity()">
            <svg viewBox="0 0 24 24" fill="none" width="18" height="18"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="9" r="2.5" stroke="currentColor" stroke-width="2"/></svg>
            Iniciar con GPS
          </button>
        </div>

        <!-- WEARABLE SYNC -->
        <div class="card" style="margin-top:14px;">
          <div style="font-family:'Syne',sans-serif;font-weight:700;margin-bottom:12px;">‚åö Dispositivos conectados</div>
          <div style="display:flex;align-items:center;justify-content:space-between;padding:10px 0;">
            <div style="display:flex;align-items:center;gap:10px;">
              <div style="width:40px;height:40px;background:var(--bg3);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;">üçé</div>
              <div><div style="font-size:14px;font-weight:600;">Apple Health</div><div style="font-size:12px;color:var(--accent3);">Sincronizado</div></div>
            </div>
            <div class="badge badge-green">Activo</div>
          </div>
          <div class="sep"></div>
          <div style="display:flex;align-items:center;justify-content:space-between;padding:10px 0;">
            <div style="display:flex;align-items:center;gap:10px;">
              <div style="width:40px;height:40px;background:var(--bg3);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;">ü§ñ</div>
              <div><div style="font-size:14px;font-weight:600;">Google Fit</div><div style="font-size:12px;color:var(--text3);">No conectado</div></div>
            </div>
            <button class="btn btn-outline btn-sm">Conectar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- STYLE PAGE -->
    <div id="page-style" class="page" style="display:none;">
      <div class="header">
        <div class="page-title">Estilo Personal</div>
      </div>
      <div style="padding:16px;">
        <!-- HAIR STYLES -->
        <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:16px;margin-bottom:12px;">üíà Cortes de pelo recomendados</div>
        <div style="font-size:13px;color:var(--text2);margin-bottom:14px;">Basado en tu an√°lisis facial: rostro ovalado</div>
        <div class="scroll-row" id="haircutList"></div>

        <div class="sep"></div>

        <!-- LOOKSMAXING TIPS -->
        <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:16px;margin-bottom:12px;">‚ú® Gu√≠a de Looksmaxing</div>
        <div id="looksmaxtips"></div>

        <div class="sep"></div>

        <!-- FACIAL EXERCISES -->
        <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:16px;margin-bottom:12px;">üßò Ejercicios faciales</div>
        <div id="facialExList"></div>

        <div class="sep"></div>

        <!-- SKINCARE -->
        <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:16px;margin-bottom:12px;">üåø Skincare personalizado</div>
        <div id="skincareList"></div>
      </div>
    </div>

    <!-- HISTORY PAGE -->
    <div id="page-history" class="page" style="display:none;">
      <div class="header">
        <div class="page-title">Historial</div>
        <div class="header-actions">
          <div class="icon-btn">
            <svg viewBox="0 0 24 24" fill="none"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>
        </div>
      </div>
      <div style="padding:16px;">
        <div class="tabs" id="historyTabs">
          <div class="tab active" onclick="switchHistTab(this,'histAll')">Todo</div>
          <div class="tab" onclick="switchHistTab(this,'histExercise')">Gym</div>
          <div class="tab" onclick="switchHistTab(this,'histNutrition')">Dieta</div>
          <div class="tab" onclick="switchHistTab(this,'histScans')">Scans</div>
        </div>
        <div id="histAll" id="histAll"></div>
        <div id="histExercise" style="display:none;"></div>
        <div id="histNutrition" style="display:none;"></div>
        <div id="histScans" style="display:none;"></div>
      </div>
    </div>
  </div><!-- end screen -->

  <!-- BOTTOM NAV -->
  <nav id="navbar">
    <div class="nav-item active" data-page="home" onclick="navigate('home')">
      <svg viewBox="0 0 24 24" fill="none"><path d="M3 9.5L12 3l9 6.5V20a1 1 0 01-1 1H4a1 1 0 01-1-1V9.5z" stroke="currentColor" stroke-width="2"/></svg>
      <span>Inicio</span>
    </div>
    <div class="nav-item" data-page="nutrition" onclick="navigate('nutrition')">
      <svg viewBox="0 0 24 24" fill="none"><path d="M18 8h1a4 4 0 010 8h-1M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8zM6 1v3M10 1v3M14 1v3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <span>Nutrici√≥n</span>
    </div>
    <div class="nav-item" data-page="exercise" onclick="navigate('exercise')">
      <svg viewBox="0 0 24 24" fill="none"><path d="M6.5 6.5l11 11M17.5 6.5l-11 11M3 12h3m12 0h3M12 3v3m0 12v3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      <span>Gym</span>
    </div>
    <div class="nav-item" data-page="scan" onclick="navigate('scan')">
      <svg viewBox="0 0 24 24" fill="none"><rect x="2" y="2" width="20" height="20" rx="5" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="2"/><path d="M12 8V6M12 18v-2M8 12H6M18 12h-2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      <span>Escaneo</span>
    </div>
    <div class="nav-item" data-page="steps" onclick="navigate('steps')">
      <svg viewBox="0 0 24 24" fill="none"><path d="M13 5.5A2.5 2.5 0 0110.5 8h0A2.5 2.5 0 0113 10.5h0A2.5 2.5 0 0115.5 8h0A2.5 2.5 0 0113 5.5zM5.5 11A2.5 2.5 0 013 13.5h0A2.5 2.5 0 015.5 16h0A2.5 2.5 0 018 13.5h0A2.5 2.5 0 015.5 11z" stroke="currentColor" stroke-width="2"/><path d="M10 15l4 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      <span>Pasos</span>
    </div>
  </nav>
</div><!-- end app -->

<!-- AI CHAT OVERLAY -->
<div class="overlay" id="aiChatOverlay">
<div class="modal" style="height:70vh;display:flex;flex-direction:column;">
  <div class="modal-handle"></div>
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
    <div>
      <div class="modal-title" style="margin-bottom:0;">Asistente IA</div>
      <div style="font-size:12px;color:var(--accent3);">‚óè En l√≠nea</div>
    </div>
    <button class="btn btn-outline btn-sm" onclick="closeOverlay('aiChatOverlay')">Cerrar</button>
  </div>
  <div id="chatMessages" style="flex:1;overflow-y:auto;margin-bottom:14px;"></div>
  <div style="display:flex;gap:8px;">
    <input class="input" placeholder="Pregunta algo sobre salud..." id="chatInput" onkeydown="if(event.key==='Enter')sendChat()" style="flex:1;">
    <button class="btn btn-primary" onclick="sendChat()" style="padding:12px 16px;">
      <svg viewBox="0 0 24 24" fill="none" width="18" height="18"><path d="M22 2L11 13M22 2L15 22l-4-9-9-4 20-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
  </div>
</div>
</div>

<!-- AI ROUTINE BUILDER OVERLAY -->
<div class="overlay" id="routineBuilderOverlay">
<div class="modal">
  <div class="modal-handle"></div>
  <div class="modal-title">Crear rutina con IA ü§ñ</div>
  <div class="modal-subtitle">Cu√©ntame qu√© tipo de rutina necesitas</div>
  <div class="input-group">
    <div class="input-label">D√≠as por semana</div>
    <div class="toggle-group" id="daysToggle">
      <div class="toggle-item active" onclick="selectDays(this,'3')">3</div>
      <div class="toggle-item" onclick="selectDays(this,'4')">4</div>
      <div class="toggle-item" onclick="selectDays(this,'5')">5</div>
      <div class="toggle-item" onclick="selectDays(this,'6')">6</div>
    </div>
  </div>
  <div class="input-group">
    <div class="input-label">Objetivo</div>
    <select class="input" id="routineGoal">
      <option>Hipertrofia (ganar m√∫sculo)</option>
      <option>P√©rdida de grasa + tono</option>
      <option>Fuerza m√°xima</option>
      <option>Resistencia muscular</option>
    </select>
  </div>
  <div class="input-group">
    <div class="input-label">Grupos prioritarios</div>
    <div style="display:flex;gap:6px;flex-wrap:wrap;" id="priorityTags">
      <div class="tag selected" onclick="toggleTag(this)">Pecho</div>
      <div class="tag" onclick="toggleTag(this)">Espalda</div>
      <div class="tag" onclick="toggleTag(this)">Piernas</div>
      <div class="tag selected" onclick="toggleTag(this)">Gl√∫teos</div>
      <div class="tag" onclick="toggleTag(this)">Hombros</div>
      <div class="tag" onclick="toggleTag(this)">Brazos</div>
    </div>
  </div>
  <div class="input-group">
    <div class="input-label">Nivel</div>
    <div class="toggle-group">
      <div class="toggle-item" onclick="selectToggle(this)">Principiante</div>
      <div class="toggle-item active" onclick="selectToggle(this)">Intermedio</div>
      <div class="toggle-item" onclick="selectToggle(this)">Avanzado</div>
    </div>
  </div>
  <button class="btn btn-primary btn-full" style="margin-top:8px;" onclick="generateAIRoutine()">
    ‚ö° Generar rutina
  </button>
</div>
</div>

<!-- FOOD SEARCH OVERLAY -->
<div class="overlay" id="foodSearchOverlay">
<div class="modal">
  <div class="modal-handle"></div>
  <div class="modal-title">Buscar alimento</div>
  <input class="input" placeholder="Ej: arroz blanco, pechuga..." id="foodQuery" oninput="searchFood()" style="margin-bottom:14px;">
  <div id="foodResults"></div>
</div>
</div>

<!-- ACTIVE WORKOUT OVERLAY -->
<div class="overlay" id="workoutActiveOverlay">
<div class="modal" style="max-height:90vh;">
  <div class="modal-handle"></div>
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
    <div>
      <div class="modal-title" id="activeWorkoutTitle">Push Day</div>
      <div style="font-size:13px;color:var(--accent3);" id="activeWorkoutProgress">Ejercicio 1 de 8</div>
    </div>
    <button class="btn btn-outline btn-sm" onclick="closeOverlay('workoutActiveOverlay')">Pausar</button>
  </div>
  <div id="activeExerciseCard" style="margin-bottom:16px;"></div>
  <div id="restTimerContainer" style="display:none;text-align:center;margin-bottom:16px;">
    <div style="font-size:13px;color:var(--text2);margin-bottom:4px;">Descanso</div>
    <div class="timer-display" id="timerValue">60</div>
    <div class="progress-bar" style="margin-top:12px;height:8px;border-radius:4px;">
      <div class="progress-fill" id="timerProgress" style="width:100%;background:linear-gradient(90deg,var(--accent3),var(--accent));border-radius:4px;transition:width 1s linear;"></div>
    </div>
  </div>
  <div id="setsContainer"></div>
  <button class="btn btn-primary btn-full pulse-glow" onclick="logSet()" style="margin-top:14px;" id="logSetBtn">
    ‚úì Serie completada
  </button>
</div>
</div>

<script>
// ===========================
// DATA & STATE
// ===========================
let state = {
  currentUser: null,
  accounts: JSON.parse(localStorage.getItem('vitalis_accounts')||'[]'),
  currentPage: 'home',
  restTimer: null,
  currentSet: 1,
  chatHistory: [],
  selectedDays: '3',
  stepsInterval: null
};

// Default users
if(!state.accounts.length) {
  state.accounts = [
    {id:'u1',name:'Carlos Mart√≠nez',email:'carlos@email.com',pass:'123456',weight:78,height:178,goal:'bulk',avatar:'CM'},
    {id:'u2',name:'Laura Garc√≠a',email:'laura@email.com',pass:'123456',weight:62,height:165,goal:'cut',avatar:'LG'},
  ];
  localStorage.setItem('vitalis_accounts', JSON.stringify(state.accounts));
}

// DATA
const exercises = {
  pecho:[
    {name:'Press de banca con barra',focus:'Pectoral mayor general',icon:'üèãÔ∏è'},
    {name:'Press inclinado con mancuernas',focus:'Pectoral superior',icon:'üí™'},
    {name:'Press declinado con barra',focus:'Pectoral inferior',icon:'‚¨áÔ∏è'},
    {name:'Aperturas en banco plano',focus:'Estiramiento y contracci√≥n',icon:'ü¶Ö'},
    {name:'Cruce de poleas',focus:'Pectoral interno y definici√≥n',icon:'‚úÇÔ∏è'},
    {name:'Fondos en paralelas',focus:'Pectoral inferior y tr√≠ceps',icon:'‚¨áÔ∏è'},
    {name:'Flexiones est√°ndar',focus:'Pecho general y resistencia',icon:'ü§∏'},
    {name:'Pec Deck (m√°quina)',focus:'Pectoral interno',icon:'üîÑ'},
    {name:'Pullover con mancuerna',focus:'Serratos y pectoral',icon:'üîô'},
    {name:'Flexiones con pies elevados',focus:'Pectoral superior',icon:'‚¨ÜÔ∏è'},
  ],
  espalda:[
    {name:'Dominadas',focus:'Dorsal ancho, tracci√≥n vertical',icon:'üèãÔ∏è'},
    {name:'Remo con barra',focus:'Dorsal, romboides, trapecio',icon:'üö£'},
    {name:'Peso muerto',focus:'Cadena posterior completa',icon:'üíÄ'},
    {name:'Jal√≥n al pecho en polea',focus:'Dorsal ancho',icon:'‚¨áÔ∏è'},
    {name:'Remo en polea baja',focus:'Dorsal central',icon:'‚ÜîÔ∏è'},
    {name:'Remo con mancuerna',focus:'Dorsal unilateral',icon:'üí™'},
    {name:'Hiperextensiones',focus:'Erector espinal',icon:'‚¨ÜÔ∏è'},
    {name:'Face pull',focus:'Deltoides posterior, manguito',icon:'üéØ'},
    {name:'Encogimientos (trapecios)',focus:'Trapecio superior',icon:'‚¨ÜÔ∏è'},
    {name:'Buenos d√≠as',focus:'Isquiotibiales, lumbares',icon:'‚òÄÔ∏è'},
  ],
  hombros:[
    {name:'Press militar con barra',focus:'Deltoides completo',icon:'üèãÔ∏è'},
    {name:'Press Arnold',focus:'Deltoides anterior y medio',icon:'üí™'},
    {name:'Elevaciones laterales',focus:'Deltoides medio',icon:'ü¶Ö'},
    {name:'Elevaciones frontales',focus:'Deltoides anterior',icon:'‚¨ÜÔ∏è'},
    {name:'P√°jaros (bent-over raise)',focus:'Deltoides posterior',icon:'üê¶'},
    {name:'Press con mancuernas sentado',focus:'Deltoides completo',icon:'ü™ë'},
    {name:'Upright row',focus:'Trapecio y deltoides lateral',icon:'‚¨ÜÔ∏è'},
    {name:'Lateral machine raise',focus:'Deltoides medio aislado',icon:'üéØ'},
    {name:'Landmine press',focus:'Deltoides anterior funcional',icon:'üí•'},
    {name:'Cable lateral raise',focus:'Deltoides medio tensi√≥n constante',icon:'üîó'},
  ],
  piernas:[
    {name:'Sentadilla con barra',focus:'Cu√°driceps, gl√∫teos, isquios',icon:'ü¶µ'},
    {name:'Prensa de piernas',focus:'Cu√°driceps y gl√∫teos',icon:'ü¶µ'},
    {name:'Extensi√≥n de piernas',focus:'Cu√°driceps aislado',icon:'ü¶µ'},
    {name:'Zancadas (lunges)',focus:'Cu√°driceps, gl√∫teos',icon:'üö∂'},
    {name:'Hack squat',focus:'Cu√°driceps, √©nfasis vasto',icon:'‚¨áÔ∏è'},
    {name:'Bulgarian split squat',focus:'Cu√°driceps y gl√∫teo unilateral',icon:'üáßüá¨'},
    {name:'Step-up con mancuernas',focus:'Cu√°driceps funcional',icon:'‚¨ÜÔ∏è'},
    {name:'Goblet squat',focus:'Cu√°driceps, n√∫cleo',icon:'üç∑'},
    {name:'Sentadilla frontal',focus:'Cu√°driceps superior',icon:'üèãÔ∏è'},
    {name:'Leg press unilateral',focus:'Cu√°driceps descompensado',icon:'1Ô∏è‚É£'},
  ],
  gluteos:[
    {name:'Hip thrust con barra',focus:'Gl√∫teo m√°ximo',icon:'üçë'},
    {name:'Peso muerto rumano',focus:'Isquiotibiales y gl√∫teo',icon:'üîô'},
    {name:'Curl femoral tumbado',focus:'Isquiotibiales aislados',icon:'üîÑ'},
    {name:'Good mornings',focus:'Isquiotibiales y lumbares',icon:'‚òÄÔ∏è'},
    {name:'Sentadilla sumo',focus:'Gl√∫teo e isquios',icon:'ü§º'},
    {name:'Kickbacks en polea',focus:'Gl√∫teo mayor',icon:'ü¶µ'},
    {name:'Abducci√≥n en m√°quina',focus:'Gl√∫teo menor y mediano',icon:'‚ÜîÔ∏è'},
    {name:'Glute bridge unilateral',focus:'Gl√∫teo asim√©trico',icon:'üåâ'},
    {name:'Cable pull-through',focus:'Gl√∫teo y erector',icon:'üîó'},
    {name:'Sentadilla profunda',focus:'Gl√∫teo completo',icon:'‚¨áÔ∏è'},
  ],
  brazos:[
    {name:'Curl con barra',focus:'B√≠ceps braquial',icon:'üí™'},
    {name:'Curl martillo',focus:'Braquial y braquiorradial',icon:'üî®'},
    {name:'Curl concentrado',focus:'B√≠ceps pico',icon:'üéØ'},
    {name:'Curl predicador',focus:'B√≠ceps parte inferior',icon:'üôè'},
    {name:'Press franc√©s',focus:'Tr√≠ceps largo',icon:'üß†'},
    {name:'Extensi√≥n en polea alta',focus:'Tr√≠ceps aislado',icon:'‚¨áÔ∏è'},
    {name:'Dips en banco',focus:'Tr√≠ceps general',icon:'üí∫'},
    {name:'Fondos cerrados',focus:'Tr√≠ceps pesado',icon:'üèãÔ∏è'},
    {name:'Curl inclinado',focus:'B√≠ceps estiramiento',icon:'üìê'},
    {name:'Kickbacks de tr√≠ceps',focus:'Tr√≠ceps cabeza lateral',icon:'ü¶µ'},
  ],
  abdominales:[
    {name:'Crunch cl√°sico',focus:'Recto abdominal',icon:'üîÑ'},
    {name:'Plancha',focus:'Core completo isom√©trico',icon:'üìê'},
    {name:'Elevaci√≥n de piernas',focus:'Recto inferior',icon:'‚¨ÜÔ∏è'},
    {name:'Russian twist',focus:'Oblicuos',icon:'üåÄ'},
    {name:'Rueda abdominal',focus:'Core completo',icon:'üîµ'},
    {name:'Mountain climbers',focus:'Core din√°mico y cardio',icon:'üèîÔ∏è'},
    {name:'Crunches en cable',focus:'Recto con resistencia',icon:'üîó'},
    {name:'Hollow hold',focus:'Core profundo',icon:'‚¨áÔ∏è'},
    {name:'Side plank',focus:'Cuadrado lumbar y oblicuo',icon:'‚ÜîÔ∏è'},
    {name:'V-sit',focus:'Recto abdominal completo',icon:'‚úåÔ∏è'},
  ]
};

const muscleGroups = Object.keys(exercises);
let selectedMuscle = 'pecho';

const supplements = [
  {name:'Prote√≠na Whey',desc:'Apoya la s√≠ntesis proteica post-entreno. Dosis recomendada: 25-40g tras entrenar.',icon:'ü•õ',tag:'B√°sico'},
  {name:'Creatina Monohidrato',desc:'Aumenta la fuerza y potencia. Dosis: 3-5g/d√≠a. Sin ciclos necesarios.',icon:'‚ö°',tag:'Fuerza'},
  {name:'Pre-entreno (cafe√≠na)',desc:'Mejora el rendimiento y el foco. M√°ximo 200-400mg cafe√≠na. No tomar tarde.',icon:'‚òï',tag:'Energ√≠a'},
  {name:'Omega-3 (EPA/DHA)',desc:'Antiinflamatorio, salud articular y cardiovascular. 2-3g/d√≠a con comidas.',icon:'üêü',tag:'Salud'},
  {name:'Vitamina D3+K2',desc:'Fundamental para testosterona, inmunidad y huesos. 2000-5000 UI/d√≠a.',icon:'‚òÄÔ∏è',tag:'Salud'},
  {name:'Magnesio',desc:'Sue√±o, recuperaci√≥n y cientos de enzimas. 300-400mg/d√≠a por la noche.',icon:'üíä',tag:'Recuperaci√≥n'},
  {name:'ZMA',desc:'Zinc, Magnesio y B6. Mejora el sue√±o y la recuperaci√≥n muscular nocturna.',icon:'üåô',tag:'Recuperaci√≥n'},
  {name:'Beta-Alanina',desc:'Reduce la fatiga muscular en esfuerzos 60-240 seg. 3.2-6.4g/d√≠a.',icon:'üî•',tag:'Resistencia'},
];

const routines = [
  {name:'Push Day A',muscles:'Pecho ¬∑ Hombros ¬∑ Tr√≠ceps',days:3,duration:55,exercises:8},
  {name:'Pull Day B',muscles:'Espalda ¬∑ B√≠ceps',days:3,duration:50,exercises:7},
  {name:'Leg Day C',muscles:'Cu√°driceps ¬∑ Gl√∫teos ¬∑ Isquios',days:3,duration:65,exercises:9},
];

const foodDB = [
  {name:'Pechuga de pollo (100g)',cal:165,p:31,c:0,f:4},
  {name:'Arroz blanco cocido (100g)',cal:130,p:2.7,c:28,f:0.3},
  {name:'Huevo entero',cal:78,p:6,c:0.6,f:5},
  {name:'Avena (40g)',cal:148,p:5,c:26,f:3},
  {name:'Pl√°tano mediano',cal:89,p:1,c:23,f:0.3},
  {name:'Pechuga de pavo (100g)',cal:135,p:29,c:0,f:2},
  {name:'Aguacate (100g)',cal:160,p:2,c:9,f:15},
  {name:'Br√≥coli (100g)',cal:34,p:3,c:7,f:0.4},
  {name:'Leche semidesnatada (200ml)',cal:98,p:6.8,c:9.4,f:3.6},
  {name:'Almendras (30g)',cal:173,p:6,c:6,f:15},
  {name:'Salm√≥n (100g)',cal:208,p:20,c:0,f:13},
  {name:'Yogur griego (150g)',cal:132,p:12,c:5,f:7},
  {name:'Quinoa cocida (100g)',cal:120,p:4.4,c:22,f:1.9},
];

const meals = {
  desayuno:[{name:'Avena con pl√°tano',cal:237,p:6,c:49,f:3.3}],
  almuerzo:[{name:'Arroz con pechuga',cal:295,p:33.7,c:28,f:4.3}],
  cena:[{name:'Salm√≥n con br√≥coli',cal:242,p:23,c:7,f:13.4}],
  snacks:[{name:'Yogur griego + almendras',cal:305,p:18,c:11,f:22}]
};

const haircuts = [
  {name:'Undercut cl√°sico',emoji:'üíá',fit:'Ovalado, cuadrado'},
  {name:'Fade lateral',emoji:'‚úÇÔ∏è',fit:'Redondo, ovalado'},
  {name:'Tup√© moderno',emoji:'üë§',fit:'Alargado, cuadrado'},
  {name:'Flequillo texturizado',emoji:'üåä',fit:'Todos'},
  {name:'French crop',emoji:'üìê',fit:'Redondo, ovalado'},
  {name:'Mid fade',emoji:'üíà',fit:'Ovalado, coraz√≥n'},
  {name:'Wolf cut',emoji:'üê∫',fit:'Ovalado, alargado'},
];

const looksmaxTips = [
  {title:'Mewing (postura lingual)',desc:'Apoya la lengua en el paladar duro. Mejora la definici√≥n mandibular con pr√°ctica constante.',icon:'üëÖ'},
  {title:'Jawline exercises',desc:'Masticar chicle duro 20min/d√≠a y hacer movimientos mandibulares laterales.',icon:'ü¶∑'},
  {title:'Hidrataci√≥n y sue√±o',desc:'8h de sue√±o y 2.5L de agua reducen ojeras, mejoran tono y reducen la edad aparente.',icon:'üíß'},
  {title:'Postura correcta',desc:'Cabeza neutral, hombros hacia atr√°s. La buena postura mejora dr√°sticamente la apariencia.',icon:'üßç'},
  {title:'√çndice graso facial',desc:'Bajar al 12-15% de grasa corporal define p√≥mulos y jawline notablemente.',icon:'üìâ'},
];

const skincareItems = [
  {time:'üåÖ Ma√±ana',steps:['Limpiador suave (pH 5.5)','Vitamina C (15% serum)','Hidratante ligero oil-free','Protector solar SPF50+']},
  {time:'üåô Noche',steps:['Doble limpieza (oil cleanser + espuma)','T√≥nico con niacinamida','Retinol (0.025% para empezar)','Hidratante nocturna con ceramidas']},
];

const facialExercises = [
  {name:'Mewing',reps:'Todo el d√≠a (conciencia constante)',desc:'Lengua completa apoyada en el paladar'},
  {name:'Jaw clench',reps:'3√ó30 segundos',desc:'Apretar y soltar la mand√≠bula'},
  {name:'Fish lips',reps:'3√ó20',desc:'Succionar mejillas hacia adentro y mantener'},
  {name:'Neck extensions',reps:'3√ó15',desc:'Extender el cuello hacia atr√°s suavemente'},
];

const scanHistory = [
  {date:'15 Feb 2026',type:'Corporal',changes:'+0.5% m√∫sculo, -0.3% grasa'},
  {date:'01 Feb 2026',type:'Facial',changes:'Simetr√≠a: 7.6/10'},
  {date:'18 Ene 2026',type:'Corporal',changes:'+1.2% m√∫sculo, -0.8% grasa'},
  {date:'04 Ene 2026',type:'Corporal',changes:'Baseline establecido'},
];

const historyItems = [
  {date:'Hoy',module:'gym',icon:'üí™',text:'Push Day A completado',detail:'8 ejercicios ¬∑ 54 min ¬∑ PR en press de banca: 100kg'},
  {date:'Hoy',module:'nutrition',icon:'ü•ó',text:'Nutrici√≥n registrada',detail:'1,460 kcal ¬∑ Prote√≠na: 87g / 140g objetivo'},
  {date:'Ayer',module:'steps',icon:'üèÉ',text:'10,580 pasos',detail:'Objetivo cumplido ¬∑ 312 kcal activas'},
  {date:'Hace 2 d√≠as',module:'gym',icon:'üí™',text:'Pull Day B completado',detail:'7 ejercicios ¬∑ 48 min'},
  {date:'Hace 3 d√≠as',module:'scan',icon:'üî¨',text:'Escaneo corporal',detail:'Grasa: 18.4% ‚Üí 18.7% ¬∑ M√∫sculo: 42.1%'},
  {date:'Hace 3 d√≠as',module:'nutrition',icon:'ü•ó',text:'Dieta',detail:'2,280 kcal ¬∑ Excedente de 180 kcal'},
];

const muscleMapData = [
  {name:'Pecho sup.',pct:68,color:'#60a5fa'},
  {name:'Pecho inf.',pct:72,color:'#60a5fa'},
  {name:'Dorsales',pct:58,color:'#a78bfa'},
  {name:'Hombros',pct:65,color:'var(--accent)'},
  {name:'B√≠ceps',pct:80,color:'var(--accent3)'},
  {name:'Tr√≠ceps',pct:76,color:'var(--accent3)'},
  {name:'Cu√°driceps',pct:55,color:'var(--accent4)'},
  {name:'Gl√∫teos',pct:50,color:'#f472b6'},
  {name:'Abdomen',pct:40,color:'var(--accent5)'},
];

const facialMetrics = [
  {name:'Simetr√≠a',val:'87%',color:'var(--accent3)'},
  {name:'Regla de tercios',val:'84%',color:'var(--accent3)'},
  {name:'Jaw definition',val:'7/10',color:'var(--accent)'},
  {name:'Edad aparente',val:'24 a√±os',color:'var(--accent4)'},
  {name:'Tono de piel',val:'Bueno',color:'var(--accent3)'},
  {name:'Manchas/imperfecciones',val:'Leves',color:'var(--accent4)'},
];

const perimeters = [
  {name:'Pecho',val:'96 cm',change:'+1 cm'},
  {name:'Cintura',val:'80 cm',change:'-0.5 cm'},
  {name:'Cadera',val:'95 cm',change:'='},
  {name:'Brazo (contra√≠do)',val:'38 cm',change:'+0.5 cm'},
  {name:'Muslo',val:'57 cm',change:'+1 cm'},
  {name:'WHR (cintura/cadera)',val:'0.84',change:'Ideal ‚úì'},
];

// AI responses
const aiResponses = [
  "Bas√°ndome en tu objetivo de ganar m√∫sculo, te recomiendo aumentar tu ingesta proteica a **2g por kg de peso corporal** (~156g diarios). Actualmente est√°s en 87g.",
  "Para maximizar el crecimiento muscular, aseg√∫rate de estar en **super√°vit cal√≥rico de 200-300 kcal**. Con tu TMB estimada, eso ser√≠a alrededor de 2,600 kcal/d√≠a.",
  "El descanso es fundamental. Dormir **7-9 horas** mejora los niveles de testosterona y GH, cruciales para la hipertrofia. ¬øTu calidad de sue√±o es buena?",
  "Veo que llevas 6,230 pasos hoy. Para tu objetivo, te recomiendo **8,000-10,000 pasos diarios** para optimizar la sensibilidad a la insulina y la recuperaci√≥n.",
  "La creatina monohidrato es el suplemento m√°s respaldado cient√≠ficamente para ganar fuerza y masa muscular. **3-5g diarios**, no necesitas carga.",
  "Detect√© que no has registrado el desayuno hoy. Recuerda que el **balance cal√≥rico total del d√≠a** es lo m√°s importante, independientemente del timing.",
];
let aiResponseIndex = 0;

// ===========================
// INIT
// ===========================
window.onload = () => {
  setTimeout(()=>{
    document.getElementById('splash').classList.add('hide');
    setTimeout(()=>{
      document.getElementById('splash').style.display='none';
      const saved = localStorage.getItem('vitalis_currentUser');
      if(saved){
        state.currentUser = JSON.parse(saved);
        initApp();
      } else {
        openOverlay('loginOverlay');
      }
    },400);
  },1800);
  renderAll();
};

function initApp(){
  document.getElementById('app').style.display='flex';
  updateHomeUser();
  startStepSimulation();
}

function updateHomeUser(){
  if(!state.currentUser) return;
  document.getElementById('homeUserName').textContent = state.currentUser.name.split(' ')[0];
  const av = document.getElementById('currentAvatar');
  av.textContent = state.currentUser.avatar;
  av.style.fontSize = '11px';
  const goalMap = {bulk:'üí™ Ganar m√∫sculo',cut:'üî• Perder grasa',maintain:'‚öñÔ∏è Mantener',health:'‚ù§Ô∏è Salud'};
  document.getElementById('homeGoalBadge').innerHTML = `<span class="badge badge-cyan">${goalMap[state.currentUser.goal]||'üéØ Objetivo'}</span><span class="badge badge-green">‚úì Activo</span>`;
}

// ===========================
// AUTH
// ===========================
function doLogin(){
  const email = document.getElementById('loginEmail').value;
  const pass = document.getElementById('loginPass').value;
  const user = state.accounts.find(a=>a.email===email && a.pass===pass);
  if(user){
    state.currentUser = user;
    localStorage.setItem('vitalis_currentUser', JSON.stringify(user));
    closeOverlay('loginOverlay');
    initApp();
  } else {
    alert('Email o contrase√±a incorrectos. Prueba: carlos@email.com / 123456');
  }
}

function doRegister(){
  const name = document.getElementById('regName').value;
  const email = document.getElementById('regEmail').value;
  const pass = document.getElementById('regPass').value;
  const weight = document.getElementById('regWeight').value;
  const height = document.getElementById('regHeight').value;
  const goal = document.getElementById('regGoal').value;
  if(!name||!email||!pass){alert('Completa todos los campos');return;}
  const initials = name.split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,2);
  const newUser = {id:'u'+Date.now(),name,email,pass,weight:+weight||70,height:+height||170,goal,avatar:initials};
  state.accounts.push(newUser);
  localStorage.setItem('vitalis_accounts', JSON.stringify(state.accounts));
  state.currentUser = newUser;
  localStorage.setItem('vitalis_currentUser', JSON.stringify(newUser));
  closeOverlay('loginOverlay');
  initApp();
}

function doLogout(){
  state.currentUser = null;
  localStorage.removeItem('vitalis_currentUser');
  closeOverlay('accountOverlay');
  document.getElementById('app').style.display='none';
  openOverlay('loginOverlay');
  if(state.stepsInterval) clearInterval(state.stepsInterval);
}

function showRegister(){document.getElementById('loginView').style.display='none';document.getElementById('registerView').style.display='block';}
function showLogin(){document.getElementById('loginView').style.display='block';document.getElementById('registerView').style.display='none';}

// ===========================
// ACCOUNT SWITCHER
// ===========================
function openAccountSwitcher(){
  renderAccountList();
  openOverlay('accountOverlay');
}

function renderAccountList(){
  const list = document.getElementById('accountList');
  list.innerHTML = state.accounts.map(acc=>`
    <div class="account-item ${state.currentUser&&state.currentUser.id===acc.id?'active-account':''}" onclick="switchToAccount('${acc.id}')">
      <div class="avatar" style="width:44px;height:44px;font-size:14px;">${acc.avatar}</div>
      <div>
        <div style="font-family:'Syne',sans-serif;font-weight:600;">${acc.name}</div>
        <div style="font-size:12px;color:var(--text2);">${acc.email}</div>
      </div>
      ${state.currentUser&&state.currentUser.id===acc.id?`<svg class="account-check" viewBox="0 0 24 24" fill="none" width="20" height="20"><path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`:''}
    </div>
  `).join('');
}

function switchToAccount(id){
  const user = state.accounts.find(a=>a.id===id);
  if(!user) return;
  state.currentUser = user;
  localStorage.setItem('vitalis_currentUser', JSON.stringify(user));
  closeOverlay('accountOverlay');
  updateHomeUser();
  showToast(`Cambiado a ${user.name}`);
}

function showAddAccount(){
  closeOverlay('accountOverlay');
  openOverlay('addAccountOverlay');
}

function closeAddAccount(){
  closeOverlay('addAccountOverlay');
  openOverlay('accountOverlay');
}

function addNewAccount(){
  const name = document.getElementById('newAccName').value;
  const email = document.getElementById('newAccEmail').value;
  const pass = document.getElementById('newAccPass').value;
  if(!name||!email||!pass){alert('Completa todos los campos');return;}
  const initials = name.split(' ').map(w=>w[0]).join('').toUpperCase().slice(0,2);
  const newUser = {id:'u'+Date.now(),name,email,pass,weight:70,height:170,goal:'health',avatar:initials};
  state.accounts.push(newUser);
  localStorage.setItem('vitalis_accounts', JSON.stringify(state.accounts));
  closeOverlay('addAccountOverlay');
  switchToAccount(newUser.id);
  showToast(`Cuenta de ${name} a√±adida`);
}

// ===========================
// NAVIGATION
// ===========================
function navigate(page){
  state.currentPage = page;
  document.querySelectorAll('.page').forEach(p=>p.style.display='none');
  document.getElementById('page-'+page).style.display='block';
  document.querySelectorAll('.nav-item').forEach(n=>{
    n.classList.toggle('active', n.dataset.page===page);
  });
  document.getElementById('screen').scrollTo(0,0);
}

// ===========================
// RENDER FUNCTIONS
// ===========================
function renderAll(){
  renderMeals();
  renderRoutines();
  renderExerciseTags();
  renderExercises('pecho');
  renderSupplements();
  renderHaircuts();
  renderLooksmax();
  renderSkincare();
  renderFacialExList();
  renderMuscleMap();
  renderPerimeters();
  renderFacialMetrics();
  renderScanHistory();
  renderHistory();
}

function renderMeals(){
  const c = document.getElementById('mealsContainer');
  if(!c) return;
  const icons = {desayuno:'üåÖ',almuerzo:'‚òÄÔ∏è',cena:'üåô',snacks:'üçé'};
  const labels = {desayuno:'Desayuno',almuerzo:'Almuerzo',cena:'Cena',snacks:'Snacks'};
  c.innerHTML = Object.keys(meals).map(m=>`
    <div style="margin-top:16px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
        <div style="font-family:'Syne',sans-serif;font-weight:600;">${icons[m]} ${labels[m]}</div>
        <button class="btn btn-outline btn-sm" onclick="openFoodSearch('${m}')">+ A√±adir</button>
      </div>
      ${meals[m].map(f=>`
        <div class="food-item">
          <div><div class="food-name">${f.name}</div><div class="food-macro">P:${f.p}g C:${f.c}g G:${f.f}g</div></div>
          <div class="food-cal">${f.cal} kcal</div>
        </div>
      `).join('')}
      ${meals[m].length===0?`<div style="padding:16px;text-align:center;color:var(--text3);font-size:13px;">Sin registros</div>`:''}
    </div>
  `).join('');
}

function renderRoutines(){
  const c = document.getElementById('routinesList');
  if(!c) return;
  c.innerHTML = routines.map(r=>`
    <div class="card" style="margin-bottom:10px;">
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <div>
          <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:15px;">${r.name}</div>
          <div style="font-size:12px;color:var(--text2);margin-top:3px;">${r.muscles}</div>
          <div style="display:flex;gap:6px;margin-top:8px;">
            <span class="badge badge-purple">${r.exercises} ejercicios</span>
            <span class="badge badge-cyan">~${r.duration} min</span>
          </div>
        </div>
        <button class="btn btn-primary btn-sm" onclick="startWorkout('${r.name}')">‚ñ∂ Iniciar</button>
      </div>
    </div>
  `).join('');
}

function renderExerciseTags(){
  const c = document.getElementById('muscleGroupTags');
  if(!c) return;
  const labels = {pecho:'üèãÔ∏è Pecho',espalda:'üîô Espalda',hombros:'üí™ Hombros',piernas:'ü¶µ Piernas',gluteos:'üçë Gl√∫teos',brazos:'üí™ Brazos',abdominales:'üî• Abdomen'};
  c.innerHTML = muscleGroups.map(g=>`
    <div class="tag ${g===selectedMuscle?'selected':''}" onclick="selectMuscleGroup('${g}')">${labels[g]}</div>
  `).join('');
}

function selectMuscleGroup(g){
  selectedMuscle = g;
  renderExerciseTags();
  renderExercises(g);
}

function renderExercises(group){
  const c = document.getElementById('exercisesList');
  if(!c) return;
  const ex = exercises[group]||[];
  c.innerHTML = ex.map(e=>`
    <div class="exercise-item">
      <div class="exercise-thumb">${e.icon}</div>
      <div>
        <div class="exercise-name">${e.name}</div>
        <div class="exercise-focus">${e.focus}</div>
      </div>
    </div>
  `).join('');
}

function renderSupplements(){
  const c = document.getElementById('supplementsList');
  if(!c) return;
  c.innerHTML = supplements.map(s=>`
    <div class="card" style="margin-bottom:10px;">
      <div style="display:flex;gap:12px;align-items:flex-start;">
        <div style="font-size:28px;">${s.icon}</div>
        <div>
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
            <div style="font-family:'Syne',sans-serif;font-weight:700;">${s.name}</div>
            <span class="badge badge-cyan">${s.tag}</span>
          </div>
          <div style="font-size:13px;color:var(--text2);">${s.desc}</div>
        </div>
      </div>
    </div>
  `).join('');
}

function renderHaircuts(){
  const c = document.getElementById('haircutList');
  if(!c) return;
  c.innerHTML = haircuts.map(h=>`
    <div style="flex-shrink:0;width:120px;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;text-align:center;cursor:pointer;" onclick="selectHaircut('${h.name}')">
      <div style="font-size:36px;margin-bottom:8px;">${h.emoji}</div>
      <div style="font-family:'Syne',sans-serif;font-weight:600;font-size:12px;">${h.name}</div>
      <div style="font-size:10px;color:var(--text3);margin-top:4px;">${h.fit}</div>
    </div>
  `).join('');
}

function renderLooksmax(){
  const c = document.getElementById('looksmaxtips');
  if(!c) return;
  c.innerHTML = looksmaxTips.map(t=>`
    <div class="card" style="margin-bottom:10px;display:flex;gap:12px;">
      <div style="font-size:24px;">${t.icon}</div>
      <div>
        <div style="font-family:'Syne',sans-serif;font-weight:600;margin-bottom:4px;">${t.title}</div>
        <div style="font-size:13px;color:var(--text2);">${t.desc}</div>
      </div>
    </div>
  `).join('');
}

function renderSkincare(){
  const c = document.getElementById('skincareList');
  if(!c) return;
  c.innerHTML = skincareItems.map(s=>`
    <div class="card" style="margin-bottom:10px;">
      <div style="font-family:'Syne',sans-serif;font-weight:700;margin-bottom:10px;">${s.time}</div>
      ${s.steps.map((st,i)=>`
        <div style="display:flex;align-items:center;gap:10px;padding:8px 0;${i<s.steps.length-1?'border-bottom:1px solid var(--border)':''}">
          <div style="width:22px;height:22px;background:rgba(0,229,255,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:700;font-size:11px;color:var(--accent);flex-shrink:0;">${i+1}</div>
          <div style="font-size:13px;">${st}</div>
        </div>
      `).join('')}
    </div>
  `).join('');
}

function renderFacialExList(){
  const c = document.getElementById('facialExList');
  if(!c) return;
  c.innerHTML = facialExercises.map(e=>`
    <div class="card" style="margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;">
      <div>
        <div style="font-family:'Syne',sans-serif;font-weight:600;">${e.name}</div>
        <div style="font-size:12px;color:var(--text2);">${e.desc}</div>
      </div>
      <span class="badge badge-cyan" style="flex-shrink:0;">${e.reps}</span>
    </div>
  `).join('');
}

function renderMuscleMap(){
  const c = document.getElementById('muscleMapGrid');
  if(!c) return;
  c.innerHTML = muscleMapData.map(m=>`
    <div class="muscle-zone">
      <div class="muscle-zone-pct">${m.pct}%</div>
      <div class="muscle-zone-name">${m.name}</div>
      <div class="muscle-zone-bar" style="background:var(--bg);margin-top:6px;">
        <div style="height:4px;border-radius:2px;width:${m.pct}%;background:${m.color};"></div>
      </div>
    </div>
  `).join('');
}

function renderPerimeters(){
  const c = document.getElementById('perimetersList');
  if(!c) return;
  c.innerHTML = perimeters.map(p=>`
    <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);">
      <div style="font-size:14px;">${p.name}</div>
      <div style="display:flex;align-items:center;gap:8px;">
        <span style="font-family:'Syne',sans-serif;font-weight:700;">${p.val}</span>
        <span style="font-size:11px;color:${p.change.includes('+')?'var(--accent3)':p.change.includes('-')?'var(--accent5)':'var(--text3)'};">${p.change}</span>
      </div>
    </div>
  `).join('');
}

function renderFacialMetrics(){
  const c = document.getElementById('facialMetrics');
  if(!c) return;
  c.innerHTML = facialMetrics.map(m=>`
    <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);">
      <div style="font-size:13px;color:var(--text2);">${m.name}</div>
      <span style="font-family:'Syne',sans-serif;font-weight:700;color:${m.color};">${m.val}</span>
    </div>
  `).join('');
}

function renderScanHistory(){
  const c = document.getElementById('scanHistoryList');
  if(!c) return;
  c.innerHTML = scanHistory.map(s=>`
    <div class="card" style="margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;">
      <div>
        <div style="font-family:'Syne',sans-serif;font-weight:600;">${s.type} ‚Äî ${s.date}</div>
        <div style="font-size:12px;color:var(--accent3);margin-top:3px;">${s.changes}</div>
      </div>
      <span class="badge badge-purple">Ver</span>
    </div>
  `).join('');
}

function renderHistory(){
  ['histAll','histExercise','histNutrition','histScans'].forEach(id=>{
    const c = document.getElementById(id);
    if(!c) return;
    let items = historyItems;
    if(id==='histExercise') items = historyItems.filter(i=>i.module==='gym');
    if(id==='histNutrition') items = historyItems.filter(i=>i.module==='nutrition');
    if(id==='histScans') items = historyItems.filter(i=>i.module==='scan');
    c.innerHTML = items.map(i=>`
      <div class="card" style="margin-bottom:8px;display:flex;gap:12px;align-items:flex-start;">
        <div style="font-size:24px;">${i.icon}</div>
        <div>
          <div style="font-size:10px;color:var(--text3);margin-bottom:2px;">${i.date}</div>
          <div style="font-family:'Syne',sans-serif;font-weight:600;font-size:14px;">${i.text}</div>
          <div style="font-size:12px;color:var(--text2);margin-top:3px;">${i.detail}</div>
        </div>
      </div>
    `).join('');
  });
}

// ===========================
// SCAN SIMULATION
// ===========================
function simulateScan(type){
  const area = event.currentTarget;
  if(!area) return;
  area.innerHTML = `<div style="font-size:24px;margin-bottom:8px;">‚è≥</div><div style="font-family:'Syne',sans-serif;font-weight:700;">Analizando con IA...</div><div style="font-size:13px;color:var(--accent);margin-top:6px;">Procesando localmente en dispositivo</div>`;
  setTimeout(()=>{
    if(type==='body'){
      area.innerHTML = `<div style="font-size:24px;margin-bottom:8px;">‚úÖ</div><div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent3);">Escaneo completado</div>`;
      document.getElementById('bodyScanResults').style.display='block';
    } else {
      area.innerHTML = `<div style="font-size:24px;margin-bottom:8px;">‚úÖ</div><div style="font-family:'Syne',sans-serif;font-weight:700;color:var(--accent3);">An√°lisis facial completado</div>`;
      document.getElementById('faceScanResults').style.display='block';
      document.getElementById('skincareRoutine').innerHTML = skincareItems.map(s=>`
        <div style="margin-bottom:12px;"><div style="font-weight:600;margin-bottom:6px;">${s.time}</div>${s.steps.map(st=>`<div style="font-size:13px;color:var(--text2);padding:4px 0;">‚Ä¢ ${st}</div>`).join('')}</div>
      `).join('');
      document.getElementById('facialExercises').innerHTML = facialExercises.map(e=>`
        <div style="padding:8px 0;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;"><div><div style="font-size:14px;font-weight:500;">${e.name}</div><div style="font-size:12px;color:var(--text2);">${e.desc}</div></div><span class="badge badge-cyan">${e.reps}</span></div>
      `).join('');
    }
  },2000);
}

// ===========================
// WORKOUT
// ===========================
function startWorkout(name){
  const routine = routines.find(r=>r.name===name)||routines[0];
  const exList = exercises.pecho.slice(0,4);
  document.getElementById('activeWorkoutTitle').textContent = name;
  document.getElementById('activeWorkoutProgress').textContent = `Ejercicio 1 de ${routine.exercises}`;
  renderActiveExercise(exList[0], 1);
  openOverlay('workoutActiveOverlay');
}

function renderActiveExercise(ex, setNum){
  document.getElementById('activeExerciseCard').innerHTML = `
    <div class="card" style="background:linear-gradient(135deg,rgba(124,58,237,0.1),rgba(0,229,255,0.05));">
      <div style="display:flex;align-items:center;gap:14px;">
        <div style="font-size:40px;">${ex.icon}</div>
        <div>
          <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:16px;">${ex.name}</div>
          <div style="font-size:12px;color:var(--text2);margin-top:3px;">${ex.focus}</div>
          <span class="badge badge-cyan" style="margin-top:8px;">4 series √ó 10-12 reps</span>
        </div>
      </div>
    </div>
  `;
  renderSets(setNum);
}

function renderSets(current){
  let html = '';
  for(let i=1;i<=4;i++){
    html += `<div class="set-row">
      <div class="set-num">${i}</div>
      <div class="input" style="flex:1;height:38px;padding:6px 12px;" placeholder="Peso kg">
        <input type="number" placeholder="Peso (kg)" style="background:transparent;border:none;outline:none;color:var(--text);width:100%;font-family:'DM Sans',sans-serif;" ${i>current?'disabled':''}>
      </div>
      <div class="input" style="width:70px;height:38px;padding:6px 12px;">
        <input type="number" placeholder="Reps" style="background:transparent;border:none;outline:none;color:var(--text);width:100%;font-family:'DM Sans',sans-serif;" ${i>current?'disabled':''}>
      </div>
      <div style="color:${i<current?'var(--accent3)':i===current?'var(--accent)':'var(--text3)'};font-size:18px;">${i<current?'‚úì':i===current?'‚óâ':'‚óã'}</div>
    </div>`;
  }
  document.getElementById('setsContainer').innerHTML = html;
}

function logSet(){
  state.currentSet = Math.min(state.currentSet+1, 4);
  startRestTimer(60);
}

function startRestTimer(seconds){
  let remaining = seconds;
  const btn = document.getElementById('logSetBtn');
  btn.textContent = 'Descansando...';
  btn.disabled = true;
  document.getElementById('restTimerContainer').style.display='block';
  document.getElementById('timerProgress').style.width='100%';
  if(state.restTimer) clearInterval(state.restTimer);
  state.restTimer = setInterval(()=>{
    remaining--;
    document.getElementById('timerValue').textContent = remaining;
    document.getElementById('timerProgress').style.width = (remaining/seconds*100)+'%';
    if(remaining<=0){
      clearInterval(state.restTimer);
      document.getElementById('restTimerContainer').style.display='none';
      btn.textContent = '‚úì Serie completada';
      btn.disabled = false;
    }
  },1000);
}

// ===========================
// AI CHAT
// ===========================
function openAIChat(){
  if(document.getElementById('chatMessages').children.length===0){
    addAIMessage('¬°Hola! Soy tu asistente de salud IA. Puedo ayudarte con nutrici√≥n, entrenamiento, suplementaci√≥n y m√°s. ¬øEn qu√© te puedo ayudar hoy?');
  }
  openOverlay('aiChatOverlay');
}

function sendChat(){
  const input = document.getElementById('chatInput');
  const msg = input.value.trim();
  if(!msg) return;
  addUserMessage(msg);
  input.value='';
  addTypingIndicator();
  setTimeout(()=>{
    removeTypingIndicator();
    addAIMessage(aiResponses[aiResponseIndex % aiResponses.length]);
    aiResponseIndex++;
  },1200+Math.random()*800);
}

function addUserMessage(text){
  const div = document.createElement('div');
  div.className='user-bubble';
  div.style.cssText='font-size:14px;';
  div.textContent=text;
  document.getElementById('chatMessages').appendChild(div);
  scrollChat();
}

function addAIMessage(text){
  const div = document.createElement('div');
  div.className='ai-bubble';
  div.style.cssText='font-size:14px;';
  div.innerHTML=text.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>');
  document.getElementById('chatMessages').appendChild(div);
  scrollChat();
}

function addTypingIndicator(){
  const div = document.createElement('div');
  div.id='typing';
  div.className='ai-bubble';
  div.innerHTML='<div class="typing-indicator"><span></span><span></span><span></span></div>';
  document.getElementById('chatMessages').appendChild(div);
  scrollChat();
}

function removeTypingIndicator(){
  const t=document.getElementById('typing');
  if(t)t.remove();
}

function scrollChat(){
  const c=document.getElementById('chatMessages');
  c.scrollTop=c.scrollHeight;
}

// ===========================
// AI ROUTINE BUILDER
// ===========================
function openAIRoutineBuilder(){openOverlay('routineBuilderOverlay');}

function selectDays(el, val){
  state.selectedDays=val;
  el.closest('.toggle-group').querySelectorAll('.toggle-item').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
}

function selectToggle(el){
  el.closest('.toggle-group').querySelectorAll('.toggle-item').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
}

function generateAIRoutine(){
  closeOverlay('routineBuilderOverlay');
  showToast('ü§ñ Rutina generada con IA y a√±adida a tu lista');
  const newRoutine = {name:`IA Routine ${state.selectedDays}d`,muscles:'Personalizado por IA',days:+state.selectedDays,duration:50,exercises:8};
  routines.unshift(newRoutine);
  renderRoutines();
}

// ===========================
// FOOD SEARCH
// ===========================
function openFoodSearch(meal){
  document.getElementById('foodQuery').dataset.meal = meal||'almuerzo';
  openOverlay('foodSearchOverlay');
  document.getElementById('foodResults').innerHTML='';
}

function openFoodScan(){
  showToast('üì∑ Apunta la c√°mara a tu comida para identificarla...');
}

function searchFood(){
  const q = document.getElementById('foodQuery').value.toLowerCase();
  if(q.length<2){document.getElementById('foodResults').innerHTML='';return;}
  const results = foodDB.filter(f=>f.name.toLowerCase().includes(q));
  document.getElementById('foodResults').innerHTML = results.length?
    results.map(f=>`
      <div class="food-item" onclick="addFood('${f.name}',${f.cal},${f.p},${f.c},${f.f})" style="cursor:pointer;">
        <div><div class="food-name">${f.name}</div><div class="food-macro">P:${f.p}g C:${f.c}g G:${f.f}g</div></div>
        <div class="food-cal">${f.cal} kcal</div>
      </div>
    `).join('')
    :'<div style="text-align:center;color:var(--text3);padding:20px;font-size:14px;">Sin resultados</div>';
}

function addFood(name,cal,p,c,f){
  const meal = document.getElementById('foodQuery').dataset.meal||'almuerzo';
  meals[meal].push({name,cal,p,c,f});
  closeOverlay('foodSearchOverlay');
  renderMeals();
  showToast(`${name} a√±adido a ${meal}`);
}

function addWater(ml){showToast(`üíß +${ml}ml registrados`);}

// ===========================
// CALCULATORS
// ===========================
function calc1RM(){
  const w = +document.getElementById('rmWeight').value;
  const r = +document.getElementById('rmReps').value;
  if(!w||!r){alert('Introduce peso y reps');return;}
  const rm = Math.round(w*(1+r/30));
  const res = document.getElementById('rmResult');
  res.textContent = `1RM estimado: ${rm} kg`;
  res.style.display='block';
}

function calcTMB(){
  const p=+document.getElementById('tmbPeso').value;
  const a=+document.getElementById('tmbAltura').value;
  const e=+document.getElementById('tmbEdad').value;
  const s=document.getElementById('tmbSexo').value;
  if(!p||!a||!e){alert('Completa todos los campos');return;}
  const tmb = s==='m' ? 10*p+6.25*a-5*e+5 : 10*p+6.25*a-5*e-161;
  const tdee = Math.round(tmb*1.55);
  document.getElementById('tmbResult').style.display='block';
  document.getElementById('tmbResult').innerHTML=`
    <div class="grid2" style="gap:10px;">
      <div class="metric-card" style="text-align:center;">
        <div class="metric-value" style="font-size:24px;">${Math.round(tmb)}</div>
        <div class="metric-label">kcal TMB</div>
      </div>
      <div class="metric-card" style="text-align:center;">
        <div class="metric-value" style="font-size:24px;">${tdee}</div>
        <div class="metric-label">kcal TDEE</div>
      </div>
    </div>
    <div style="font-size:12px;color:var(--text3);margin-top:8px;text-align:center;">Actividad moderada (3-5 d√≠as/semana)</div>
  `;
}

// ===========================
// TABS
// ===========================
function switchExTab(el, tabId){
  el.closest('.tabs').querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  ['tabRoutines','tabExercises','tabCalculators','tabSupplements'].forEach(id=>{
    const el2=document.getElementById(id);
    if(el2)el2.style.display=id===tabId?'block':'none';
  });
}

function switchScanTab(el, tabId){
  el.closest('.tabs').querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  ['scanBody','scanFace','scanHistory'].forEach(id=>{
    const el2=document.getElementById(id);
    if(el2)el2.style.display=id===tabId?'block':'none';
  });
}

function switchHistTab(el, tabId){
  el.closest('.tabs').querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  ['histAll','histExercise','histNutrition','histScans'].forEach(id=>{
    const el2=document.getElementById(id);
    if(el2)el2.style.display=id===tabId?'block':'none';
  });
}

// ===========================
// MISC
// ===========================
function selectMood(el, emoji){
  document.querySelectorAll('#page-home .card div[onclick^="selectMood"]').forEach(d=>{
    d.style.transform='scale(1)';
    d.querySelector('div').style.fontSize='30px';
  });
  el.style.transform='scale(1.2)';
  showToast(`Estado de √°nimo registrado: ${emoji}`);
}

function selectHaircut(name){showToast(`üíà ${name} seleccionado ‚Äî Prueba con AR pr√≥ximamente`);}

function toggleTag(el){el.classList.toggle('selected');}

function startGPSActivity(){showToast('üìç GPS activado ‚Äî Iniciando actividad...');}

function startStepSimulation(){
  if(state.stepsInterval) clearInterval(state.stepsInterval);
  state.stepsInterval = setInterval(()=>{
    const current = parseInt(document.getElementById('bigSteps')?.textContent?.replace(',','')||6230);
    const inc = Math.floor(Math.random()*8);
    const newVal = current+inc;
    const fmt = newVal.toLocaleString('es-ES');
    const bs = document.getElementById('bigSteps');
    const sd = document.getElementById('stepsDisplay');
    if(bs) bs.textContent = fmt;
    if(sd) sd.textContent = fmt;
  },3000);
}

// OVERLAY HELPERS
function openOverlay(id){document.getElementById(id).classList.add('open');}
function closeOverlay(id){document.getElementById(id).classList.remove('open');}

// Click outside to close
document.querySelectorAll('.overlay').forEach(o=>{
  o.addEventListener('click',e=>{
    if(e.target===o) o.classList.remove('open');
  });
});

// TOAST
function showToast(msg){
  const existing = document.getElementById('toast');
  if(existing) existing.remove();
  const t=document.createElement('div');
  t.id='toast';
  t.style.cssText=`position:fixed;bottom:96px;left:50%;transform:translateX(-50%);background:var(--card2);border:1px solid var(--border);border-radius:20px;padding:10px 20px;font-size:13px;z-index:999;white-space:nowrap;box-shadow:0 4px 20px rgba(0,0,0,0.4);animation:fadeUp 0.3s ease;`;
  t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=>{t.style.opacity='0';t.style.transition='opacity 0.3s';setTimeout(()=>t.remove(),300);},2500);
}
</script>
</body>
</html>
